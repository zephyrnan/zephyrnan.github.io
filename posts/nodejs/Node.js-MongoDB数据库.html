<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.26" />
    <style>
      :root {
        --vp-c-bg: #fff;
      }

      [data-theme='dark'] {
        --vp-c-bg: #1b1b1f;
      }

      html,
      body {
        background-color: var(--vp-c-bg);
      }
    </style>
    <script>
      const useChoice = localStorage.getItem('vuepress-color-scheme')
      const systemStatus =
        'matchMedia' in window
          ? window.matchMedia('(prefers-color-scheme: dark)').matches
          : false

      if (useChoice === 'light') {
        document.documentElement.dataset.theme = 'light'
      } else if (useChoice === 'dark' || systemStatus) {
        document.documentElement.dataset.theme = 'dark'
      }
    </script>
    <link rel="icon" href="/bg.jpg"><title>Node.js + MongoDB ç”Ÿäº§çº§æœ€ä½³å®è·µæŒ‡å— | æ¥ æ¸¡ä½™ç”Ÿ</title><meta name="description" content="æ¥ æ¸¡ä½™ç”Ÿ çš„ä¸ªäººåšå®¢">
    <link rel="preload" href="/assets/style-C2kXVMuK.css" as="style"><link rel="stylesheet" href="/assets/style-C2kXVMuK.css">
    <link rel="modulepreload" href="/assets/app-DiRdVEu8.js"><link rel="modulepreload" href="/assets/Node.js-MongoDBæ•°æ®åº“.html-CkJufFl7.js">
    <link rel="prefetch" href="/assets/about.html-Cybb5Vvj.js" as="script"><link rel="prefetch" href="/assets/guestbook.html-D3h5ZeX5.js" as="script"><link rel="prefetch" href="/assets/portfolio.html-Cx1pqtsv.js" as="script"><link rel="prefetch" href="/assets/index.html-CmsaVecO.js" as="script"><link rel="prefetch" href="/assets/åšå®¢æŒ‡å—.html-Bv6GZYhZ.js" as="script"><link rel="prefetch" href="/assets/AJAX å­¦ä¹ ç¬”è®°.html-RkDsl6_V.js" as="script"><link rel="prefetch" href="/assets/Axioså®Œæ•´å­¦ä¹ ç¬”è®°.html-Dpvp4ebw.js" as="script"><link rel="prefetch" href="/assets/CSS å±æ€§é€ŸæŸ¥æ‰‹å†Œ.html-BVpRrjNi.js" as="script"><link rel="prefetch" href="/assets/expressçš„ä½¿ç”¨.html-DWDzyB7H.js" as="script"><link rel="prefetch" href="/assets/GitHubæ–°æ‰‹å®Œå…¨æŒ‡å—.html-w6bf7qoz.js" as="script"><link rel="prefetch" href="/assets/HTML5 ä¸ CSS ç»¼åˆå­¦ä¹ ç¬”è®°.html-h9YF3y08.js" as="script"><link rel="prefetch" href="/assets/JavaScript å­¦ä¹ ç¬”è®°.html-fEaPK3oy.js" as="script"><link rel="prefetch" href="/assets/Node.js å­¦ä¹ ç¬”è®°.html-B7BDNjZ1.js" as="script"><link rel="prefetch" href="/assets/Promise å­¦ä¹ ç¬”è®°.html-DRWw4v9V.js" as="script"><link rel="prefetch" href="/assets/index.html-XiQ7JoPw.js" as="script"><link rel="prefetch" href="/assets/SpringBoot å®Œæ•´å­¦ä¹ ç¬”è®°.html-Bx891POM.js" as="script"><link rel="prefetch" href="/assets/Tailwind-CSS-ç¬”è®°.html-DUr03-_z.js" as="script"><link rel="prefetch" href="/assets/TypeScript å¿«é€Ÿä¸Šæ‰‹.html-KDfa5OLX.js" as="script"><link rel="prefetch" href="/assets/Vue3 å­¦ä¹ ç¬”è®°.html-DFU0o1LS.js" as="script"><link rel="prefetch" href="/assets/Windows _ WSL _ Docker è¸©å‘ä¸é€šå…³æŒ‡å—.html-Cp3dDBeV.js" as="script"><link rel="prefetch" href="/assets/ä¸ªäººåšå®¢æ­å»ºæŒ‡å—.html-AzSVGubP.js" as="script"><link rel="prefetch" href="/assets/MongoDBæ•°æ®åº“åŸºç¡€ä½¿ç”¨.html-CabD3juZ.js" as="script"><link rel="prefetch" href="/assets/Node.js-Expressæ¡†æ¶.html-Bel1SQM5.js" as="script"><link rel="prefetch" href="/assets/Node.js-HTTPæ¨¡å—.html-Dh1-hj4x.js" as="script"><link rel="prefetch" href="/assets/Node.js-NPMåŒ…ç®¡ç†.html-DSGjfZV4.js" as="script"><link rel="prefetch" href="/assets/Node.js-æ–‡ä»¶ç³»ç»Ÿæ¨¡å—.html-Cf3ukDMt.js" as="script"><link rel="prefetch" href="/assets/Node.js-æ¨¡å—åŒ–è®¾è®¡.html-CLMFXMJV.js" as="script"><link rel="prefetch" href="/assets/index.html-CETdmVyo.js" as="script"><link rel="prefetch" href="/assets/404.html-Dqia_CfM.js" as="script"><link rel="prefetch" href="/assets/Valine.min-BFEZSN5P.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><div class="vp-theme-container external-link-icon" vp-container><!--[--><header class="vp-navbar" vp-navbar><div class="vp-toggle-sidebar-button" title="toggle sidebar" aria-expanded="false" role="button" tabindex="0"><div class="icon" aria-hidden="true"><span></span><span></span><span></span></div></div><span><a class="route-link" href="/"><img class="vp-site-logo" src="/author.jpg" alt="æ¥ æ¸¡ä½™ç”Ÿ"><span class="vp-site-name vp-hide-mobile" aria-hidden="true">æ¥ æ¸¡ä½™ç”Ÿ</span></a></span><div class="vp-navbar-items-wrapper" style=""><!--[--><!--]--><nav class="vp-navbar-items vp-hide-mobile" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="é¦–é¡µ"><!--[--><!--[--><!--]--><!--]-->é¦–é¡µ<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/posts/" aria-label="ç¬”è®°"><!--[--><!--[--><!--]--><!--]-->ç¬”è®°<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/portfolio.html" aria-label="ä½œå“é›†"><!--[--><!--[--><!--]--><!--]-->ä½œå“é›†<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/guestbook.html" aria-label="ç•™è¨€æ¿"><!--[--><!--[--><!--]--><!--]-->ç•™è¨€æ¿<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/about.html" aria-label="å…³äº"><!--[--><!--[--><!--]--><!--]-->å…³äº<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/zephyrnan" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->GitHub<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://blog.csdn.net/2303_80433826?type=blog" aria-label="CSDN" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->CSDN<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><button type="button" class="vp-toggle-color-mode-button" title="toggle color mode"><svg class="light-icon" viewbox="0 0 32 32" style=""><path d="M16 12.005a4 4 0 1 1-4 4a4.005 4.005 0 0 1 4-4m0-2a6 6 0 1 0 6 6a6 6 0 0 0-6-6z" fill="currentColor"></path><path d="M5.394 6.813l1.414-1.415l3.506 3.506L8.9 10.318z" fill="currentColor"></path><path d="M2 15.005h5v2H2z" fill="currentColor"></path><path d="M5.394 25.197L8.9 21.691l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 25.005h2v5h-2z" fill="currentColor"></path><path d="M21.687 23.106l1.414-1.415l3.506 3.506l-1.414 1.414z" fill="currentColor"></path><path d="M25 15.005h5v2h-5z" fill="currentColor"></path><path d="M21.687 8.904l3.506-3.506l1.414 1.415l-3.506 3.505z" fill="currentColor"></path><path d="M15 2.005h2v5h-2z" fill="currentColor"></path></svg><svg class="dark-icon" viewbox="0 0 32 32" style="display:none;"><path d="M13.502 5.414a15.075 15.075 0 0 0 11.594 18.194a11.113 11.113 0 0 1-7.975 3.39c-.138 0-.278.005-.418 0a11.094 11.094 0 0 1-3.2-21.584M14.98 3a1.002 1.002 0 0 0-.175.016a13.096 13.096 0 0 0 1.825 25.981c.164.006.328 0 .49 0a13.072 13.072 0 0 0 10.703-5.555a1.01 1.01 0 0 0-.783-1.565A13.08 13.08 0 0 1 15.89 4.38A1.015 1.015 0 0 0 14.98 3z" fill="currentColor"></path></svg></button><form class="search-box" role="search"><input type="search" placeholder="æœç´¢æ–‡æ¡£" autocomplete="off" spellcheck="false" value><!----></form></div></header><!--]--><div class="vp-sidebar-mask"></div><!--[--><aside class="vp-sidebar" vp-sidebar><nav class="vp-navbar-items" aria-label="site navigation"><!--[--><div class="vp-navbar-item"><a class="route-link auto-link" href="/" aria-label="é¦–é¡µ"><!--[--><!--[--><!--]--><!--]-->é¦–é¡µ<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link route-link-active auto-link" href="/posts/" aria-label="ç¬”è®°"><!--[--><!--[--><!--]--><!--]-->ç¬”è®°<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/portfolio.html" aria-label="ä½œå“é›†"><!--[--><!--[--><!--]--><!--]-->ä½œå“é›†<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/guestbook.html" aria-label="ç•™è¨€æ¿"><!--[--><!--[--><!--]--><!--]-->ç•™è¨€æ¿<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="route-link auto-link" href="/about.html" aria-label="å…³äº"><!--[--><!--[--><!--]--><!--]-->å…³äº<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://github.com/zephyrnan" aria-label="GitHub" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->GitHub<!--[--><!--[--><!--]--><!--]--></a></div><div class="vp-navbar-item"><a class="auto-link external-link" href="https://blog.csdn.net/2303_80433826?type=blog" aria-label="CSDN" rel="noopener noreferrer" target="_blank"><!--[--><!--[--><!--]--><!--]-->CSDN<!--[--><!--[--><!--]--><!--]--></a></div><!--]--></nav><!--[--><!--]--><ul class="vp-sidebar-items"><!--[--><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading collapsible">å‰ç«¯å¼€å‘ <span class="right arrow"></span></p><ul class="vp-sidebar-children" style="display:none;"><!--[--><li><p tabindex="0" class="vp-sidebar-item collapsible">AJAX å­¦ä¹ ç¬”è®° <span class="right arrow"></span></p><ul class="vp-sidebar-children" style="display:none;"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/posts/AJAX%20%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html" aria-label="AJAX å­¦ä¹ ç¬”è®°"><!--[--><!--[--><!--]--><!--]-->AJAX å­¦ä¹ ç¬”è®°<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item collapsible">Axios å®Œæ•´å­¦ä¹ ç¬”è®° <span class="right arrow"></span></p><ul class="vp-sidebar-children" style="display:none;"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/posts/Axios%E5%AE%8C%E6%95%B4%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html" aria-label="Axios å®Œæ•´å­¦ä¹ ç¬”è®°"><!--[--><!--[--><!--]--><!--]-->Axios å®Œæ•´å­¦ä¹ ç¬”è®°<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item collapsible">CSS å±æ€§é€ŸæŸ¥æ‰‹å†Œ <span class="right arrow"></span></p><ul class="vp-sidebar-children" style="display:none;"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/posts/CSS%20%E5%B1%9E%E6%80%A7%E9%80%9F%E6%9F%A5%E6%89%8B%E5%86%8C.html" aria-label="CSS å±æ€§é€ŸæŸ¥æ‰‹å†Œ"><!--[--><!--[--><!--]--><!--]-->CSS å±æ€§é€ŸæŸ¥æ‰‹å†Œ<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item collapsible">HTML5 ä¸ CSS ç»¼åˆå­¦ä¹ ç¬”è®° <span class="right arrow"></span></p><ul class="vp-sidebar-children" style="display:none;"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/posts/HTML5%20%E4%B8%8E%20CSS%20%E7%BB%BC%E5%90%88%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html" aria-label="HTML5 ä¸ CSS ç»¼åˆå­¦ä¹ ç¬”è®°"><!--[--><!--[--><!--]--><!--]-->HTML5 ä¸ CSS ç»¼åˆå­¦ä¹ ç¬”è®°<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item collapsible">JavaScript å­¦ä¹ ç¬”è®° <span class="right arrow"></span></p><ul class="vp-sidebar-children" style="display:none;"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/posts/JavaScript%20%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html" aria-label="JavaScript å­¦ä¹ ç¬”è®°"><!--[--><!--[--><!--]--><!--]-->JavaScript å­¦ä¹ ç¬”è®°<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item collapsible">Promise å­¦ä¹ ç¬”è®° <span class="right arrow"></span></p><ul class="vp-sidebar-children" style="display:none;"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/posts/Promise%20%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html" aria-label="Promise å­¦ä¹ ç¬”è®°"><!--[--><!--[--><!--]--><!--]-->Promise å­¦ä¹ ç¬”è®°<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item collapsible">Tailwind CSS å®Œæ•´ç¬”è®° <span class="right arrow"></span></p><ul class="vp-sidebar-children" style="display:none;"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/posts/Tailwind-CSS-%E7%AC%94%E8%AE%B0.html" aria-label="Tailwind CSS å®Œæ•´ç¬”è®°"><!--[--><!--[--><!--]--><!--]-->Tailwind CSS å®Œæ•´ç¬”è®°<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item collapsible">TypeScript å¿«é€Ÿä¸Šæ‰‹ <span class="right arrow"></span></p><ul class="vp-sidebar-children" style="display:none;"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/posts/TypeScript%20%E5%BF%AB%E9%80%9F%E4%B8%8A%E6%89%8B.html" aria-label="TypeScript å¿«é€Ÿä¸Šæ‰‹"><!--[--><!--[--><!--]--><!--]-->TypeScript å¿«é€Ÿä¸Šæ‰‹<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item collapsible">Vue3 å­¦ä¹ ç¬”è®° <span class="right arrow"></span></p><ul class="vp-sidebar-children" style="display:none;"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/posts/Vue3%20%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html" aria-label="Vue3 å­¦ä¹ ç¬”è®°"><!--[--><!--[--><!--]--><!--]-->Vue3 å­¦ä¹ ç¬”è®°<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading active collapsible">Node.js æ·±å…¥å­¦ä¹  <span class="down arrow"></span></p><ul class="vp-sidebar-children" style=""><!--[--><li><p tabindex="0" class="vp-sidebar-item collapsible">MongoDB å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨ <span class="right arrow"></span></p><ul class="vp-sidebar-children" style="display:none;"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/posts/nodejs/MongoDB%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8.html" aria-label="MongoDB å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨"><!--[--><!--[--><!--]--><!--]-->MongoDB å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item active collapsible">Node.js + MongoDB ç”Ÿäº§çº§æœ€ä½³å®è·µæŒ‡å— <span class="down arrow"></span></p><ul class="vp-sidebar-children" style=""><!--[--><li><a class="route-link route-link-active auto-link vp-sidebar-item active" href="/posts/nodejs/Node.js-MongoDB%E6%95%B0%E6%8D%AE%E5%BA%93.html" aria-label="Node.js + MongoDB ç”Ÿäº§çº§æœ€ä½³å®è·µæŒ‡å—"><!--[--><!--[--><!--]--><!--]-->Node.js + MongoDB ç”Ÿäº§çº§æœ€ä½³å®è·µæŒ‡å—<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item collapsible">Node.js Express æ¡†æ¶ <span class="right arrow"></span></p><ul class="vp-sidebar-children" style="display:none;"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/posts/nodejs/Node.js-Express%E6%A1%86%E6%9E%B6.html" aria-label="Node.js Express æ¡†æ¶"><!--[--><!--[--><!--]--><!--]-->Node.js Express æ¡†æ¶<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item collapsible">Node.js HTTP æ¨¡å— <span class="right arrow"></span></p><ul class="vp-sidebar-children" style="display:none;"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/posts/nodejs/Node.js-HTTP%E6%A8%A1%E5%9D%97.html" aria-label="Node.js HTTP æ¨¡å—"><!--[--><!--[--><!--]--><!--]-->Node.js HTTP æ¨¡å—<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item collapsible">Node.js NPM åŒ…ç®¡ç† <span class="right arrow"></span></p><ul class="vp-sidebar-children" style="display:none;"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/posts/nodejs/Node.js-NPM%E5%8C%85%E7%AE%A1%E7%90%86.html" aria-label="Node.js NPM åŒ…ç®¡ç†"><!--[--><!--[--><!--]--><!--]-->Node.js NPM åŒ…ç®¡ç†<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item collapsible">Node.js æ–‡ä»¶ç³»ç»Ÿæ¨¡å— <span class="right arrow"></span></p><ul class="vp-sidebar-children" style="display:none;"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/posts/nodejs/Node.js-%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F%E6%A8%A1%E5%9D%97.html" aria-label="Node.js æ–‡ä»¶ç³»ç»Ÿæ¨¡å—"><!--[--><!--[--><!--]--><!--]-->Node.js æ–‡ä»¶ç³»ç»Ÿæ¨¡å—<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item collapsible">Node.js æ¨¡å—åŒ–è®¾è®¡ <span class="right arrow"></span></p><ul class="vp-sidebar-children" style="display:none;"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/posts/nodejs/Node.js-%E6%A8%A1%E5%9D%97%E5%8C%96%E8%AE%BE%E8%AE%A1.html" aria-label="Node.js æ¨¡å—åŒ–è®¾è®¡"><!--[--><!--[--><!--]--><!--]-->Node.js æ¨¡å—åŒ–è®¾è®¡<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading collapsible">åç«¯å¼€å‘ <span class="right arrow"></span></p><ul class="vp-sidebar-children" style="display:none;"><!--[--><li><p tabindex="0" class="vp-sidebar-item collapsible">Express åŸºæœ¬ä½¿ç”¨ <span class="right arrow"></span></p><ul class="vp-sidebar-children" style="display:none;"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/posts/express%E7%9A%84%E4%BD%BF%E7%94%A8.html" aria-label="Express åŸºæœ¬ä½¿ç”¨"><!--[--><!--[--><!--]--><!--]-->Express åŸºæœ¬ä½¿ç”¨<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item collapsible">Node.js å­¦ä¹ ç¬”è®° <span class="right arrow"></span></p><ul class="vp-sidebar-children" style="display:none;"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/posts/Node.js%20%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html" aria-label="Node.js å­¦ä¹ ç¬”è®°"><!--[--><!--[--><!--]--><!--]-->Node.js å­¦ä¹ ç¬”è®°<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item collapsible">SpringBoot å®Œæ•´å­¦ä¹ ç¬”è®° <span class="right arrow"></span></p><ul class="vp-sidebar-children" style="display:none;"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/posts/SpringBoot%20%E5%AE%8C%E6%95%B4%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0.html" aria-label="SpringBoot å®Œæ•´å­¦ä¹ ç¬”è®°"><!--[--><!--[--><!--]--><!--]-->SpringBoot å®Œæ•´å­¦ä¹ ç¬”è®°<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item vp-sidebar-heading collapsible">å¼€å‘å·¥å…· <span class="right arrow"></span></p><ul class="vp-sidebar-children" style="display:none;"><!--[--><li><p tabindex="0" class="vp-sidebar-item collapsible">Windows + WSL + Docker è¸©å‘ä¸é€šå…³æŒ‡å— <span class="right arrow"></span></p><ul class="vp-sidebar-children" style="display:none;"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/posts/Windows%20_%20WSL%20_%20Docker%20%E8%B8%A9%E5%9D%91%E4%B8%8E%E9%80%9A%E5%85%B3%E6%8C%87%E5%8D%97.html" aria-label="Windows + WSL + Docker è¸©å‘ä¸é€šå…³æŒ‡å—"><!--[--><!--[--><!--]--><!--]-->Windows + WSL + Docker è¸©å‘ä¸é€šå…³æŒ‡å—<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item collapsible">GitHub æ–°æ‰‹å®Œå…¨æŒ‡å— <span class="right arrow"></span></p><ul class="vp-sidebar-children" style="display:none;"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/posts/GitHub%E6%96%B0%E6%89%8B%E5%AE%8C%E5%85%A8%E6%8C%87%E5%8D%97.html" aria-label="GitHub æ–°æ‰‹å®Œå…¨æŒ‡å—"><!--[--><!--[--><!--]--><!--]-->GitHub æ–°æ‰‹å®Œå…¨æŒ‡å—<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><li><p tabindex="0" class="vp-sidebar-item collapsible">ä¸ªäººåšå®¢æ­å»ºæŒ‡å— <span class="right arrow"></span></p><ul class="vp-sidebar-children" style="display:none;"><!--[--><li><a class="route-link auto-link vp-sidebar-item" href="/posts/%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA%E6%8C%87%E5%8D%97.html" aria-label="ä¸ªäººåšå®¢æ­å»ºæŒ‡å—"><!--[--><!--[--><!--]--><!--]-->ä¸ªäººåšå®¢æ­å»ºæŒ‡å—<!--[--><!--[--><!--]--><!--]--></a><!----></li><!--]--></ul></li><!--]--></ul></li><!--]--></ul><!--[--><!--]--></aside><!--]--><!--[--><main class="vp-page"><!--[--><!--]--><div vp-content><!--[--><!--]--><div id="content"><h1 id="node-js-mongodb-ç”Ÿäº§çº§æœ€ä½³å®è·µæŒ‡å—" tabindex="-1"><a class="header-anchor" href="#node-js-mongodb-ç”Ÿäº§çº§æœ€ä½³å®è·µæŒ‡å—"><span>Node.js + MongoDB ç”Ÿäº§çº§æœ€ä½³å®è·µæŒ‡å—</span></a></h1><h2 id="_1-mongodb-ç®€ä»‹ä¸æ ¸å¿ƒæ¦‚å¿µ" tabindex="-1"><a class="header-anchor" href="#_1-mongodb-ç®€ä»‹ä¸æ ¸å¿ƒæ¦‚å¿µ"><span>1. MongoDB ç®€ä»‹ä¸æ ¸å¿ƒæ¦‚å¿µ</span></a></h2><p>MongoDB æ˜¯ä¸€ä¸ªåŸºäºåˆ†å¸ƒå¼æ–‡ä»¶å­˜å‚¨çš„æ•°æ®åº“ï¼Œæ ¸å¿ƒä¼˜åŠ¿åœ¨äºçµæ´»çš„æ–‡æ¡£æ¨¡å‹ï¼ˆJSON-likeï¼‰å’Œæ¨ªå‘æ‰©å±•èƒ½åŠ›ã€‚</p><h3 id="æ ¸å¿ƒæ˜ å°„å…³ç³»" tabindex="-1"><a class="header-anchor" href="#æ ¸å¿ƒæ˜ å°„å…³ç³»"><span>æ ¸å¿ƒæ˜ å°„å…³ç³»</span></a></h3><table><thead><tr><th style="text-align:left;">SQL æ¦‚å¿µ</th><th style="text-align:left;">MongoDB æ¦‚å¿µ</th><th style="text-align:left;">å…³é”®å·®å¼‚</th></tr></thead><tbody><tr><td style="text-align:left;">Database</td><td style="text-align:left;">Database</td><td style="text-align:left;">æ•°æ®åº“</td></tr><tr><td style="text-align:left;">Table</td><td style="text-align:left;"><strong>Collection é›†åˆ</strong></td><td style="text-align:left;">é›†åˆï¼ˆæ— å¼ºåˆ¶æ¨¡å¼ï¼Œä½†åœ¨åº”ç”¨å±‚é€šå¸¸æœ‰æ¨¡å¼ï¼‰</td></tr><tr><td style="text-align:left;">Row è¡Œ</td><td style="text-align:left;"><strong>Document æ–‡æ¡£</strong></td><td style="text-align:left;">æ–‡æ¡£ï¼ˆBSON æ ¼å¼ï¼Œæœ€å¤§ 16MBï¼‰</td></tr><tr><td style="text-align:left;">Column åˆ—</td><td style="text-align:left;"><strong>Field åœº</strong></td><td style="text-align:left;">å­—æ®µ</td></tr><tr><td style="text-align:left;">Primary Key</td><td style="text-align:left;"><strong>_id</strong></td><td style="text-align:left;">é»˜è®¤ä¸»é”®ï¼ˆObjectIdï¼Œè‡ªåŠ¨ç”Ÿæˆï¼Œå¸¦æ—¶é—´æˆ³ï¼‰</td></tr></tbody></table><hr><h2 id="_2-æ•°æ®åº“è¿æ¥-å•ä¾‹æ¨¡å¼-è¿™æ˜¯é‡ç‚¹" tabindex="-1"><a class="header-anchor" href="#_2-æ•°æ®åº“è¿æ¥-å•ä¾‹æ¨¡å¼-è¿™æ˜¯é‡ç‚¹"><span>2. æ•°æ®åº“è¿æ¥ï¼šå•ä¾‹æ¨¡å¼ (è¿™æ˜¯é‡ç‚¹)</span></a></h2><p>åœ¨ Web åº”ç”¨ï¼ˆExpress/Koa/NestJSï¼‰ä¸­ï¼Œ<strong>åˆ‡å‹¿</strong>åœ¨ API è·¯ç”±ä¸­è¿æ¥æ•°æ®åº“ã€‚åº”è¯¥åœ¨åº”ç”¨å¯åŠ¨æ—¶è¿æ¥ä¸€æ¬¡ï¼Œå¹¶åœ¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå¤ç”¨ã€‚</p><h3 id="_2-1-æ¨èç›®å½•ç»“æ„" tabindex="-1"><a class="header-anchor" href="#_2-1-æ¨èç›®å½•ç»“æ„"><span>2.1 æ¨èç›®å½•ç»“æ„</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">src/</span>
<span class="line">â”œâ”€â”€ config/</span>
<span class="line">â”‚   â””â”€â”€ db.js        &lt;-- æ•°æ®åº“è¿æ¥æ¨¡å—</span>
<span class="line">â”œâ”€â”€ models/          &lt;-- Mongoose æ¨¡å‹å®šä¹‰</span>
<span class="line">â”œâ”€â”€ app.js           &lt;-- å…¥å£æ–‡ä»¶</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-2-é…ç½®æ–‡ä»¶-config-db-js" tabindex="-1"><a class="header-anchor" href="#_2-2-é…ç½®æ–‡ä»¶-config-db-js"><span>2.2 é…ç½®æ–‡ä»¶ (config/db.js)</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;mongoose&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> <span class="token function-variable function">connectDB</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// Mongoose 6+ ä¸éœ€è¦ useNewUrlParser ç­‰åºŸå¼ƒé€‰é¡¹</span></span>
<span class="line">    <span class="token keyword">const</span> conn <span class="token operator">=</span> <span class="token keyword">await</span> mongoose<span class="token punctuation">.</span><span class="token function">connect</span><span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">MONGODB_URI</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token comment">// ç”Ÿäº§ç¯å¢ƒå»ºè®®é…ç½®è¿æ¥æ± </span></span>
<span class="line">      <span class="token literal-property property">maxPoolSize</span><span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> </span>
<span class="line">      <span class="token literal-property property">serverSelectionTimeoutMS</span><span class="token operator">:</span> <span class="token number">5000</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">socketTimeoutMS</span><span class="token operator">:</span> <span class="token number">45000</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">MongoDB Connected: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>conn<span class="token punctuation">.</span>connection<span class="token punctuation">.</span>host<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">Error: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>error<span class="token punctuation">.</span>message<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    process<span class="token punctuation">.</span><span class="token function">exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è¿æ¥å¤±è´¥åˆ™ç»ˆæ­¢è¿›ç¨‹</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> connectDB<span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_2-3-å…¥å£æ–‡ä»¶-app-js" tabindex="-1"><a class="header-anchor" href="#_2-3-å…¥å£æ–‡ä»¶-app-js"><span>2.3 å…¥å£æ–‡ä»¶ (app.js)</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> express <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;express&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> connectDB <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./config/db&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;dotenv&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">config</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token function">express</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 1. å…ˆè¿æ¥æ•°æ®åº“</span></span>
<span class="line"><span class="token function">connectDB</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// 2. å†å¯åŠ¨æœåŠ¡å™¨</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;Server running on port 3000&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="_3-mongoose-æ¨¡å¼è®¾è®¡-schema" tabindex="-1"><a class="header-anchor" href="#_3-mongoose-æ¨¡å¼è®¾è®¡-schema"><span>3. Mongoose æ¨¡å¼è®¾è®¡ (Schema)</span></a></h2><h3 id="_3-1-æ ‡å‡†-schema-å®šä¹‰" tabindex="-1"><a class="header-anchor" href="#_3-1-æ ‡å‡†-schema-å®šä¹‰"><span>3.1 æ ‡å‡† Schema å®šä¹‰</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;mongoose&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> userSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">mongoose<span class="token punctuation">.</span>Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token string">&#39;ç”¨æˆ·åä¸ºå¿…å¡«é¡¹&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">unique</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// æ³¨æ„ï¼šunique ä¸æ˜¯éªŒè¯å™¨ï¼Œè€Œæ˜¯æ„å»ºå”¯ä¸€ç´¢å¼•çš„æŒ‡ä»¤</span></span>
<span class="line">    <span class="token literal-property property">trim</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">index</span><span class="token operator">:</span> <span class="token boolean">true</span>   <span class="token comment">// å¸¸ç”¨æŸ¥è¯¢å­—æ®µå»ºè®®åŠ ç´¢å¼•</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">required</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">unique</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">match</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">^\S+@\S+\.\S+$</span><span class="token regex-delimiter">/</span></span><span class="token punctuation">,</span> <span class="token string">&#39;é‚®ç®±æ ¼å¼ä¸æ­£ç¡®&#39;</span><span class="token punctuation">]</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">role</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">type</span><span class="token operator">:</span> String<span class="token punctuation">,</span></span>
<span class="line">    <span class="token keyword">enum</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&#39;user&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;admin&#39;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">&#39;user&#39;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token comment">// åµŒå¥—å¯¹è±¡</span></span>
<span class="line">  <span class="token literal-property property">profile</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">age</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> Number<span class="token punctuation">,</span> <span class="token literal-property property">min</span><span class="token operator">:</span> <span class="token number">0</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">bio</span><span class="token operator">:</span> String</span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token comment">// å¼•ç”¨å…¶ä»–é›†åˆ (å…³è”å…³ç³»)</span></span>
<span class="line">  <span class="token literal-property property">posts</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">type</span><span class="token operator">:</span> mongoose<span class="token punctuation">.</span>Schema<span class="token punctuation">.</span>Types<span class="token punctuation">.</span>ObjectId<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">ref</span><span class="token operator">:</span> <span class="token string">&#39;Post&#39;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">]</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">timestamps</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// è‡ªåŠ¨ç®¡ç† createdAt å’Œ updatedAt</span></span>
<span class="line">  <span class="token literal-property property">toJSON</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">virtuals</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// è¾“å‡º JSON æ—¶åŒ…å«è™šæ‹Ÿå±æ€§</span></span>
<span class="line">  <span class="token literal-property property">toObject</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">virtuals</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// è™šæ‹Ÿå±æ€§ (ä¸ä¼šå­˜å…¥æ•°æ®åº“ï¼Œä½†èƒ½åƒå­—æ®µä¸€æ ·è®¿é—®)</span></span>
<span class="line">userSchema<span class="token punctuation">.</span><span class="token function">virtual</span><span class="token punctuation">(</span><span class="token string">&#39;isAdult&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>profile<span class="token punctuation">.</span>age <span class="token operator">&gt;=</span> <span class="token number">18</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">module<span class="token punctuation">.</span>exports <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&#39;User&#39;</span><span class="token punctuation">,</span> userSchema<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="_4-crud-æ“ä½œä¸æ€§èƒ½ä¼˜åŒ–" tabindex="-1"><a class="header-anchor" href="#_4-crud-æ“ä½œä¸æ€§èƒ½ä¼˜åŒ–"><span>4. CRUD æ“ä½œä¸æ€§èƒ½ä¼˜åŒ–</span></a></h2><h3 id="_4-1-ğŸš€-æ€§èƒ½ä¼˜åŒ–çš„é»„é‡‘æ³•åˆ™-lean" tabindex="-1"><a class="header-anchor" href="#_4-1-ğŸš€-æ€§èƒ½ä¼˜åŒ–çš„é»„é‡‘æ³•åˆ™-lean"><span>4.1 ğŸš€ æ€§èƒ½ä¼˜åŒ–çš„é»„é‡‘æ³•åˆ™ï¼š<code>.lean()</code></span></a></h3><p>Mongoose é»˜è®¤è¿”å›çš„æ˜¯ &quot;Mongoose Document&quot; å¯¹è±¡ï¼ˆåŒ…å« <code>save</code>, <code>toObject</code> ç­‰å‡ ç™¾ä¸ªæ–¹æ³•ï¼‰ï¼Œéå¸¸æ¶ˆè€—å†…å­˜å’Œæ€§èƒ½ã€‚ <strong>å¦‚æœåœ¨åªè¯»åœºæ™¯ï¼ˆä¸éœ€è¦ä¿®æ”¹æ•°æ®ï¼‰ï¼ŒåŠ¡å¿…ä½¿ç”¨ <code>.lean()</code>ï¼Œæ€§èƒ½æå‡å¯è¾¾ 5-10 å€ã€‚</strong></p><h3 id="_4-2-è¯»å–æ“ä½œ-read" tabindex="-1"><a class="header-anchor" href="#_4-2-è¯»å–æ“ä½œ-read"><span>4.2 è¯»å–æ“ä½œ (Read)</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// âŒ æ…¢ï¼šè¿”å›å¤æ‚å¯¹è±¡</span></span>
<span class="line"><span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">role</span><span class="token operator">:</span> <span class="token string">&#39;user&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// âœ… å¿«ï¼šè¿”å›çº¯ JS å¯¹è±¡ (POJO)</span></span>
<span class="line"><span class="token keyword">const</span> users <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">find</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">role</span><span class="token operator">:</span> <span class="token string">&#39;user&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">select</span><span class="token punctuation">(</span><span class="token string">&#39;username email&#39;</span><span class="token punctuation">)</span> <span class="token comment">// åªå–éœ€è¦çš„å­—æ®µ (Projection)</span></span>
<span class="line">  <span class="token punctuation">.</span><span class="token function">lean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> </span>
<span class="line"></span>
<span class="line"><span class="token comment">// é€šè¿‡ ID æŸ¥è¯¢</span></span>
<span class="line"><span class="token comment">// æ³¨æ„ï¼šMongoose ä¼šè‡ªåŠ¨å°†å­—ç¬¦ä¸²è½¬ä¸º ObjectIdï¼Œæ— éœ€æ‰‹åŠ¨è½¬æ¢</span></span>
<span class="line"><span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">lean</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-å†™å…¥ä¸æ›´æ–°-create-update" tabindex="-1"><a class="header-anchor" href="#_4-3-å†™å…¥ä¸æ›´æ–°-create-update"><span>4.3 å†™å…¥ä¸æ›´æ–° (Create / Update)</span></a></h3><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// åˆ›å»º</span></span>
<span class="line"><span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  <span class="token literal-property property">username</span><span class="token operator">:</span> <span class="token string">&#39;john_doe&#39;</span><span class="token punctuation">,</span></span>
<span class="line">  <span class="token literal-property property">email</span><span class="token operator">:</span> <span class="token string">&#39;john@example.com&#39;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// æ›´æ–° (æ¨è findByIdAndUpdate è€Œä¸æ˜¯ find -&gt; modify -&gt; saveï¼Œé™¤ééœ€è¦è§¦å‘ hook)</span></span>
<span class="line"><span class="token keyword">const</span> updatedUser <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findByIdAndUpdate</span><span class="token punctuation">(</span></span>
<span class="line">  id<span class="token punctuation">,</span> </span>
<span class="line">  <span class="token punctuation">{</span> <span class="token literal-property property">$set</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token string-property property">&#39;profile.bio&#39;</span><span class="token operator">:</span> <span class="token string">&#39;New Bio&#39;</span> <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token comment">// ä½¿ç”¨ $set é¿å…è¦†ç›–æ•´ä¸ªå¯¹è±¡</span></span>
<span class="line">  <span class="token punctuation">{</span> </span>
<span class="line">    <span class="token keyword">new</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>          <span class="token comment">// è¿”å›æ›´æ–°åçš„æ–‡æ¡£</span></span>
<span class="line">    <span class="token literal-property property">runValidators</span><span class="token operator">:</span> <span class="token boolean">true</span> <span class="token comment">// æ›´æ–°æ—¶ä¹Ÿæ‰§è¡Œ Schema éªŒè¯</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="_5-è¿›é˜¶ç‰¹æ€§-äº‹åŠ¡-transactions" tabindex="-1"><a class="header-anchor" href="#_5-è¿›é˜¶ç‰¹æ€§-äº‹åŠ¡-transactions"><span>5. è¿›é˜¶ç‰¹æ€§ï¼šäº‹åŠ¡ (Transactions)</span></a></h2><p>MongoDB 4.0+ æ”¯æŒå¤šæ–‡æ¡£ ACID äº‹åŠ¡ã€‚è¿™åœ¨æ¶‰åŠèµ„é‡‘ã€åº“å­˜ç­‰å¼ºä¸€è‡´æ€§åœºæ™¯ä¸‹æ˜¯å¿…é¡»çš„ã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> mongoose <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;mongoose&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> User <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./models/User&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token keyword">const</span> Wallet <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;./models/Wallet&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">transferMoney</span><span class="token punctuation">(</span><span class="token parameter">fromUserId<span class="token punctuation">,</span> toUserId<span class="token punctuation">,</span> amount</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> session <span class="token operator">=</span> <span class="token keyword">await</span> mongoose<span class="token punctuation">.</span><span class="token function">startSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  session<span class="token punctuation">.</span><span class="token function">startTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">  <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> opts <span class="token operator">=</span> <span class="token punctuation">{</span> session <span class="token punctuation">}</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 1. æ‰£æ¬¾</span></span>
<span class="line">    <span class="token keyword">const</span> sender <span class="token operator">=</span> <span class="token keyword">await</span> Wallet<span class="token punctuation">.</span><span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span></span>
<span class="line">      <span class="token punctuation">{</span> <span class="token literal-property property">userId</span><span class="token operator">:</span> fromUserId <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">{</span> <span class="token literal-property property">$inc</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">balance</span><span class="token operator">:</span> <span class="token operator">-</span>amount <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      opts</span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>sender<span class="token punctuation">.</span>balance <span class="token operator">&lt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#39;ä½™é¢ä¸è¶³&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token comment">// æŠ›å‡ºé”™è¯¯ä¼šè‡ªåŠ¨è§¦å‘ catch ä¸­çš„ abortTransaction</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 2. åŠ æ¬¾</span></span>
<span class="line">    <span class="token keyword">await</span> Wallet<span class="token punctuation">.</span><span class="token function">findOneAndUpdate</span><span class="token punctuation">(</span></span>
<span class="line">      <span class="token punctuation">{</span> <span class="token literal-property property">userId</span><span class="token operator">:</span> toUserId <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      <span class="token punctuation">{</span> <span class="token literal-property property">$inc</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">balance</span><span class="token operator">:</span> amount <span class="token punctuation">}</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">      opts</span>
<span class="line">    <span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">    <span class="token comment">// 3. æäº¤äº‹åŠ¡</span></span>
<span class="line">    <span class="token keyword">await</span> session<span class="token punctuation">.</span><span class="token function">commitTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;è½¬è´¦æˆåŠŸ&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token comment">// 4. å›æ»šäº‹åŠ¡</span></span>
<span class="line">    <span class="token keyword">await</span> session<span class="token punctuation">.</span><span class="token function">abortTransaction</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;è½¬è´¦å¤±è´¥ï¼Œå·²å›æ»š:&#39;</span><span class="token punctuation">,</span> error<span class="token punctuation">.</span>message<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">finally</span> <span class="token punctuation">{</span></span>
<span class="line">    session<span class="token punctuation">.</span><span class="token function">endSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="_6-å¸¸è§å‘ç‚¹ä¸è§£å†³æ–¹æ¡ˆ" tabindex="-1"><a class="header-anchor" href="#_6-å¸¸è§å‘ç‚¹ä¸è§£å†³æ–¹æ¡ˆ"><span>6. å¸¸è§å‘ç‚¹ä¸è§£å†³æ–¹æ¡ˆ</span></a></h2><h3 id="_6-1-objectid-çš„é™·é˜±" tabindex="-1"><a class="header-anchor" href="#_6-1-objectid-çš„é™·é˜±"><span>6.1 ObjectId çš„é™·é˜±</span></a></h3><ul><li><p><strong>åŸç”Ÿé©±åŠ¨ (Native Driver)</strong>: å¿…é¡»æ‰‹åŠ¨è½¬æ¢å­—ç¬¦ä¸² IDã€‚</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> ObjectId <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;mongodb&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token comment">// å¿…é¡»è¿™æ ·å†™ï¼Œå¦åˆ™æŸ¥ä¸åˆ°</span></span>
<span class="line">db<span class="token punctuation">.</span><span class="token function">collection</span><span class="token punctuation">(</span><span class="token string">&#39;users&#39;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> <span class="token literal-property property">_id</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">ObjectId</span><span class="token punctuation">(</span><span class="token string">&#39;64bf...&#39;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p><strong>Mongoose</strong>: è‡ªåŠ¨å¤„ç†ï¼Œæ— éœ€æ‰‹åŠ¨è½¬æ¢</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line">User<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span><span class="token string">&#39;64bf...&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// è‡ªåŠ¨å¤„ç†</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div></li></ul><h3 id="_6-2-æ•°ç»„æŸ¥è¯¢" tabindex="-1"><a class="header-anchor" href="#_6-2-æ•°ç»„æŸ¥è¯¢"><span>6.2 æ•°ç»„æŸ¥è¯¢</span></a></h3><ul><li><code>{ tags: &quot;js&quot; }</code>: æ•°ç»„ä¸­<strong>åŒ…å«</strong> &quot;js&quot; å³åŒ¹é…ï¼ˆæœ€å¸¸ç”¨ï¼‰ã€‚</li><li><code>{ tags: [&quot;js&quot;, &quot;node&quot;] }</code>: æ•°ç»„<strong>ä¸¥æ ¼ç­‰äº</strong> <code>[&quot;js&quot;, &quot;node&quot;]</code>ï¼ˆé¡ºåºå’Œæ•°é‡éƒ½å¿…é¡»ä¸€è‡´ï¼‰ã€‚</li><li><code>{ tags: { $all: [&quot;js&quot;, &quot;node&quot;] } }</code>: æ•°ç»„<strong>åŒ…å«</strong> &quot;js&quot; å’Œ &quot;node&quot;ï¼ˆé¡ºåºæ— å…³ï¼‰ã€‚</li></ul><h3 id="_6-3-å”¯ä¸€ç´¢å¼•-unique-index" tabindex="-1"><a class="header-anchor" href="#_6-3-å”¯ä¸€ç´¢å¼•-unique-index"><span>6.3 å”¯ä¸€ç´¢å¼• (Unique Index)</span></a></h3><p>å¦‚æœåœ¨ Schema ä¸­æ·»åŠ äº† <code>unique: true</code> ä½†ä¸ç”Ÿæ•ˆï¼Œé€šå¸¸æ˜¯å› ä¸ºé›†åˆä¸­å·²ç»å­˜åœ¨é‡å¤æ•°æ®ã€‚ä½ éœ€è¦å…ˆæ¸…ç†è„æ•°æ®ï¼Œç„¶åæ‰‹åŠ¨é‡å»ºç´¢å¼•ï¼š</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">syncIndexes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><hr><h2 id="_7-ç°ä»£åŒ–å¼€å‘-typescript-æ”¯æŒ" tabindex="-1"><a class="header-anchor" href="#_7-ç°ä»£åŒ–å¼€å‘-typescript-æ”¯æŒ"><span>7. ç°ä»£åŒ–å¼€å‘ï¼šTypeScript æ”¯æŒ</span></a></h2><p>å¦‚æœä½ åœ¨ä½¿ç”¨ TypeScriptï¼ˆå¼ºçƒˆæ¨èï¼‰ï¼ŒMongoose ç°åœ¨æä¾›äº†å¾ˆå¥½çš„ç±»å‹æ¨æ–­ã€‚</p><div class="language-typescript line-numbers-mode" data-highlighter="prismjs" data-ext="ts"><pre><code class="language-typescript"><span class="line"><span class="token keyword">import</span> mongoose<span class="token punctuation">,</span> <span class="token punctuation">{</span> Schema<span class="token punctuation">,</span> InferSchemaType <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&#39;mongoose&#39;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> userSchema <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">  name<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> String<span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  email<span class="token operator">:</span> <span class="token punctuation">{</span> type<span class="token operator">:</span> String<span class="token punctuation">,</span> required<span class="token operator">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span></span>
<span class="line">  age<span class="token operator">:</span> Number</span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// è‡ªåŠ¨ä» Schema æ¨æ–­ TS ç±»å‹ï¼Œæ— éœ€æ‰‹åŠ¨å®šä¹‰ interface</span></span>
<span class="line"><span class="token class-name"><span class="token keyword">type</span></span> UserType <span class="token operator">=</span> InferSchemaType<span class="token operator">&lt;</span><span class="token keyword">typeof</span> userSchema<span class="token operator">&gt;</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">const</span> User <span class="token operator">=</span> mongoose<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&#39;User&#39;</span><span class="token punctuation">,</span> userSchema<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">getUser</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token comment">// user å˜é‡ä¼šè‡ªåŠ¨è·å¾—ç±»å‹æç¤º</span></span>
<span class="line">  <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findOne</span><span class="token punctuation">(</span><span class="token punctuation">{</span> name<span class="token operator">:</span> <span class="token string">&#39;Alice&#39;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>user<span class="token punctuation">.</span>email<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// TS çŸ¥é“è¿™é‡Œæœ‰ email å­—æ®µ</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8-å®‰å…¨æ€§æ£€æŸ¥æ¸…å•" tabindex="-1"><a class="header-anchor" href="#_8-å®‰å…¨æ€§æ£€æŸ¥æ¸…å•"><span>8. å®‰å…¨æ€§æ£€æŸ¥æ¸…å•</span></a></h2><ol><li><strong>ä¸è¦å°† MongoDB æš´éœ²åœ¨å…¬ç½‘</strong>ï¼šåœ¨ <code>mongod.conf</code> ä¸­è®¾ç½® <code>bindIp: 127.0.0.1</code> æˆ–ä½¿ç”¨é˜²ç«å¢™ã€‚</li><li><strong>å¯ç”¨è®¤è¯</strong>ï¼šå§‹ç»ˆå¼€å¯ Authenticationï¼Œåˆ›å»º root ç”¨æˆ·å’Œä¸šåŠ¡æ•°æ®åº“çš„ä¸“å±ç”¨æˆ·ã€‚</li><li><strong>é˜²æ­¢ NoSQL æ³¨å…¥</strong>ï¼š <ul><li>å¦‚æœæ˜¯ä½¿ç”¨ <code>express</code>ï¼Œä¸è¦ç›´æ¥å°† <code>req.body</code> ä¼ å…¥æŸ¥è¯¢æ¡ä»¶ã€‚</li><li>æ¶æ„ç”¨æˆ·å¯èƒ½å‘é€ <code>{ &quot;username&quot;: { &quot;$gt&quot;: &quot;&quot; } }</code> æ¥ç»•è¿‡ç™»å½•ã€‚</li><li><strong>è§£å†³</strong>ï¼šä½¿ç”¨ <code>express-mongo-sanitize</code> ä¸­é—´ä»¶ã€‚</li></ul></li></ol><div class="language-bash line-numbers-mode" data-highlighter="prismjs" data-ext="sh"><pre><code class="language-bash"><span class="line"><span class="token function">npm</span> <span class="token function">install</span> express-mongo-sanitize</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">const</span> mongoSanitize <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;express-mongo-sanitize&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">mongoSanitize</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// ç§»é™¤ req.body ä¸­çš„ $ ç¬¦å·</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><hr><h2 id="æ€»ç»“" tabindex="-1"><a class="header-anchor" href="#æ€»ç»“"><span>æ€»ç»“</span></a></h2><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ MongoDB + Node.jsï¼Œéœ€è¦ç‰¹åˆ«æ³¨æ„ï¼š</p><ol><li><strong>è¿æ¥ç®¡ç†</strong>ï¼šä½¿ç”¨å•ä¾‹æ¨¡å¼ï¼Œåœ¨åº”ç”¨å¯åŠ¨æ—¶è¿æ¥ä¸€æ¬¡</li><li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼šå……åˆ†åˆ©ç”¨ <code>.lean()</code> å’Œç´¢å¼•æ¥æå‡æŸ¥è¯¢æ€§èƒ½</li><li><strong>æ•°æ®å®‰å…¨</strong>ï¼šå¯ç”¨è®¤è¯ï¼Œé˜²æ­¢ NoSQL æ³¨å…¥</li><li><strong>äº‹åŠ¡æ”¯æŒ</strong>ï¼šåœ¨éœ€è¦å¼ºä¸€è‡´æ€§çš„åœºæ™¯ä½¿ç”¨äº‹åŠ¡</li><li><strong>ç±»å‹å®‰å…¨</strong>ï¼šæ¨èä½¿ç”¨ TypeScript æå‡å¼€å‘ä½“éªŒ</li></ol><p>éµå¾ªè¿™äº›æœ€ä½³å®è·µï¼Œå¯ä»¥æ„å»ºå‡ºé«˜æ€§èƒ½ã€å®‰å…¨å¯é çš„ MongoDB åº”ç”¨ã€‚</p><hr><blockquote><p>ğŸ’¡ <strong>ç›¸å…³èµ„æº</strong>ï¼š</p><ul><li><a href="https://www.mongodb.com/docs/" target="_blank" rel="noopener noreferrer">MongoDB å®˜æ–¹æ–‡æ¡£</a></li><li><a href="https://mongoosejs.com/docs/" target="_blank" rel="noopener noreferrer">Mongoose å®˜æ–¹æ–‡æ¡£</a></li><li><a class="route-link" href="/posts/nodejs/MongoDB%E6%95%B0%E6%8D%AE%E5%BA%93%E5%9F%BA%E7%A1%80%E4%BD%BF%E7%94%A8.html">MongoDB å¸¸ç”¨å‘½ä»¤é€ŸæŸ¥è¡¨</a></li></ul></blockquote><!----><hr><p><strong>å¦‚æœä½ æœ‰ä»»ä½•é—®é¢˜æˆ–æƒ³åˆ†äº«ä½ çš„ MongoDB ä½¿ç”¨ç»éªŒï¼Œæ¬¢è¿åœ¨è¯„è®ºåŒºäº¤æµï¼</strong></p></div><!--[--><!--]--></div><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="vp-meta-item last-updated"><span class="meta-item-label">æœ€åæ›´æ–°: </span><time class="meta-item-info" datetime="2025-12-06T18:46:35.000Z" data-allow-mismatch>2025/12/7 02:46</time></div><div class="vp-meta-item contributors"><span class="meta-item-label">è´¡çŒ®è€…: </span><span class="meta-item-info"><!--[--><!--[--><span class="contributor" title="email: 2764304248@qq.com">52nnnn</span><!--[-->, <!--]--><!--]--><!--[--><span class="contributor" title="email: noreply@anthropic.com">Claude</span><!----><!--]--><!--]--></span></div></div></footer><!----><!--[--><!--]--></main><!--]--></div><!--[--><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-DiRdVEu8.js" defer></script>
  </body>
</html>
