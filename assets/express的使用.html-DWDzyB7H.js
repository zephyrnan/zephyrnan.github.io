import{_ as s,c as a,a as e,o as p}from"./app-DiRdVEu8.js";const t={};function l(i,n){return p(),a("div",null,[...n[0]||(n[0]=[e(`<h1 id="ã€expressåŸºæœ¬ä½¿ç”¨ã€‘" tabindex="-1"><a class="header-anchor" href="#ã€expressåŸºæœ¬ä½¿ç”¨ã€‘"><span>ã€ExpressåŸºæœ¬ä½¿ç”¨ã€‘</span></a></h1><blockquote><p>https://www.expressjs.com.cn/</p></blockquote><p>åŸºäº Node.js å¹³å°ï¼Œå¿«é€Ÿã€å¼€æ”¾ã€æç®€çš„ web å¼€å‘æ¡†æ¶ã€‚</p><h2 id="_1-expressçš„å®‰è£…æ–¹å¼" tabindex="-1"><a class="header-anchor" href="#_1-expressçš„å®‰è£…æ–¹å¼"><span>1.Expressçš„å®‰è£…æ–¹å¼</span></a></h2><p>Expressçš„å®‰è£…å¯ç›´æ¥ä½¿ç”¨npmåŒ…ç®¡ç†å™¨ä¸Šçš„é¡¹ç›®ï¼Œåœ¨å®‰è£…npmä¹‹å‰å¯å…ˆå®‰è£…æ·˜å®é•œåƒï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">npm install -g cnpm --registry=https://registry.npmmirror.com/</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ ·æˆ‘ä»¬ä½¿ç”¨cnpmçš„æ¥ä»£æ›¿npmï¼Œè¿™ä½¿å¾—ä¸‹è½½é€Ÿåº¦æé«˜å¾ˆå¤šï¼›å…¶æ¬¡ä½ éœ€è¦åœ¨ä½ é¡¹ç›®ç›®å½•ä¸‹è¿è¡Œä»¥ä¸‹æŒ‡ä»¤æ¥åˆå§‹åŒ–npmï¼ŒæœŸé—´æ‰€æœ‰æç¤ºæŒ‰enteré”®å³å¯ï¼Œè¿™ä¼šç”Ÿæˆpackage.jsonï¼Œå®ƒæ˜¯ç”¨äºæè¿°é¡¹ç›®æ–‡ä»¶çš„ã€‚</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">cnpm init</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>å†è¾“å…¥</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">cnpm install</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™ä¸‹é¡¹ç›®ç›®å½•ä¸­åˆä¼šå¤šå‡ºä¸€ä¸ªå«node_modulesæ–‡ä»¶å¤¹ï¼Œé‡Œé¢æ˜¯node.jsä¸ºæˆ‘ä»¬æä¾›çš„æ¨¡å—ï¼Œå½“ç„¶ç°åœ¨æ²¡æœ‰ã€‚æ¥ä¸‹æ¥ä¾¿æ˜¯çœŸæ­£çš„å®‰è£…expressäº†ï¼Œæ‰§è¡Œï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">cnpm install express --save</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>è¿™æ—¶ï¼Œæˆ‘ä»¬çœ‹åˆ°node_modulesæ–‡ä»¶å¤¹å¤šäº†è®¸å¤šä¸åŒç‰ˆæœ¬çš„åº”ç”¨æ–‡ä»¶å¤¹ï¼Œæ¥ä¸‹æ¥æ‰§è¡Œ</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">express --version</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>æŸ¥çœ‹expressæ˜¯å¦å®‰è£…æˆåŠŸï¼Œå¦‚æœæ˜¾ç¤ºç‰ˆæœ¬å·ï¼Œåˆ™å®‰è£…æ­£ç¡®ã€‚</p><p><a href="https://camo.githubusercontent.com/9557ea07fe902df24af13c88a3fe6cb442604ea5c8ee7afdae49346884da7f68/68747470733a2f2f69302e6864736c622e636f6d2f6266732f616c62756d2f363263376233636534313962643339306230383233313463636238323333653562326361666136352e706e67" target="_blank" rel="noopener noreferrer"><img src="https://camo.githubusercontent.com/9557ea07fe902df24af13c88a3fe6cb442604ea5c8ee7afdae49346884da7f68/68747470733a2f2f69302e6864736c622e636f6d2f6266732f616c62756d2f363263376233636534313962643339306230383233313463636238323333653562326361666136352e706e67" alt="image-20221103194431096"></a></p><h2 id="_2-è¿è¡ŒåŸç†" tabindex="-1"><a class="header-anchor" href="#_2-è¿è¡ŒåŸç†"><span>2.è¿è¡ŒåŸç†</span></a></h2><p><strong>åº•å±‚ï¼šhttpæ¨¡å—</strong></p><blockquote><p>Expressæ¡†æ¶å»ºç«‹åœ¨node.jså†…ç½®çš„httpæ¨¡å—ä¸Šã€‚httpæ¨¡å—ç”ŸæˆæœåŠ¡å™¨çš„åŸå§‹ä»£ç å¦‚ä¸‹</p></blockquote><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">var http = require(&quot;http&quot;);</span>
<span class="line"></span>
<span class="line">var app = http.createServer(function(request, response) {</span>
<span class="line">  response.writeHead(200, {&quot;Content-Type&quot;: &quot;text/plain&quot;});</span>
<span class="line">  response.end(&quot;Hello world!&quot;);</span>
<span class="line">});</span>
<span class="line"></span>
<span class="line">app.listen(3000, &quot;localhost&quot;);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>Expressæ¡†æ¶çš„æ ¸å¿ƒæ˜¯å¯¹httpæ¨¡å—çš„å†åŒ…è£…ã€‚ä¸Šé¢çš„ä»£ç ç”¨Expressæ”¹å†™å¦‚ä¸‹</p></blockquote><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">var express = require(&#39;express&#39;);</span>
<span class="line">var app = express();</span>
<span class="line"></span>
<span class="line">app.get(&#39;/&#39;, function (req, res) {</span>
<span class="line">  res.send(&#39;Hello world!&#39;);</span>
<span class="line">});</span>
<span class="line"></span>
<span class="line">app.listen(3000);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>Expressæ¡†æ¶ç­‰äºåœ¨httpæ¨¡å—ä¹‹ä¸Šï¼ŒåŠ äº†ä¸€ä¸ªä¸­é—´å±‚</p></blockquote><p><strong>ä»€ä¹ˆæ˜¯ä¸­é—´ä»¶</strong></p><blockquote><ul><li>ç®€å•è¯´ï¼Œä¸­é—´ä»¶ï¼ˆmiddlewareï¼‰å°±æ˜¯å¤„ç†HTTPè¯·æ±‚çš„å‡½æ•°ã€‚å®ƒæœ€å¤§çš„ç‰¹ç‚¹å°±æ˜¯ï¼Œä¸€ä¸ªä¸­é—´ä»¶å¤„ç†å®Œï¼Œå†ä¼ é€’ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ã€‚Appå®ä¾‹åœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œä¼šè°ƒç”¨ä¸€ç³»åˆ—çš„ä¸­é—´ä»¶</li><li>æ¯ä¸ªä¸­é—´ä»¶å¯ä»¥ä»Appå®ä¾‹ï¼Œæ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œä¾æ¬¡ä¸ºrequestå¯¹è±¡ï¼ˆä»£è¡¨HTTPè¯·æ±‚ï¼‰ã€responseå¯¹è±¡ï¼ˆä»£è¡¨HTTPå›åº”ï¼‰ï¼Œnextå›è°ƒå‡½æ•°ï¼ˆä»£è¡¨ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ï¼‰ã€‚æ¯ä¸ªä¸­é—´ä»¶éƒ½å¯ä»¥å¯¹HTTPè¯·æ±‚ï¼ˆrequestå¯¹è±¡ï¼‰è¿›è¡ŒåŠ å·¥ï¼Œå¹¶ä¸”å†³å®šæ˜¯å¦è°ƒç”¨nextæ–¹æ³•ï¼Œå°†requestå¯¹è±¡å†ä¼ ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ã€‚</li></ul></blockquote><ul><li>ä¸€ä¸ªä¸è¿›è¡Œä»»ä½•æ“ä½œã€åªä¼ é€’<code>request</code>å¯¹è±¡çš„ä¸­é—´ä»¶ï¼Œå°±æ˜¯ä¸‹é¢è¿™æ ·</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">function</span> <span class="token function">uselessMiddleware</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>  <span class="token comment">// req:è¯·æ±‚å¯¹è±¡, res:å“åº”å¯¹è±¡, next:ä¸‹ä¸€ä¸ªä¸­é—´ä»¶</span></span>
<span class="line">  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è°ƒç”¨next()å°†æ§åˆ¶æƒä¼ é€’ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶,ä¸è°ƒç”¨åˆ™è¯·æ±‚ä¼šæŒ‚èµ·</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ğŸ“Š <strong>è¿è¡Œæ•ˆæœ</strong>:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">// å®¢æˆ·ç«¯è¯·æ±‚ â†’ ä¸­é—´ä»¶1 â†’ è°ƒç”¨next() â†’ ä¸­é—´ä»¶2 â†’ è°ƒç”¨next() â†’ è·¯ç”±å¤„ç†å™¨</span>
<span class="line">// å¦‚æœä¸è°ƒç”¨next(),è¯·æ±‚ä¼šä¸€ç›´ç­‰å¾…,æœ€ç»ˆè¶…æ—¶</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>âš ï¸ <strong>æ³¨æ„äº‹é¡¹</strong>:</p><ul><li><strong>å¿…é¡»è°ƒç”¨next()</strong>: å¦‚æœä¸è°ƒç”¨,è¯·æ±‚ä¼šæŒ‚èµ·,å®¢æˆ·ç«¯æ— æ³•æ”¶åˆ°å“åº”</li><li><strong>ä¸­é—´ä»¶é¡ºåº</strong>: ä¸­é—´ä»¶æŒ‰ç…§app.use()çš„é¡ºåºä¾æ¬¡æ‰§è¡Œ</li><li><strong>ä¸è¦åœ¨next()åå‘é€å“åº”</strong>: è°ƒç”¨next()åä¸åº”è¯¥å†è°ƒç”¨res.send()ç­‰æ–¹æ³•</li><li><strong>å¼‚æ­¥ä¸­é—´ä»¶</strong>: å¦‚æœä¸­é—´ä»¶åŒ…å«å¼‚æ­¥æ“ä½œ,ç¡®ä¿åœ¨å¼‚æ­¥å®Œæˆåè°ƒç”¨next()</li><li><strong>æ€§èƒ½è€ƒè™‘</strong>: é¿å…åœ¨ä¸­é—´ä»¶ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œ,ä¼šå½±å“æ‰€æœ‰è¯·æ±‚</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// å¸¸è§é”™è¯¯:å¿˜è®°è°ƒç”¨next()</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;å¤„ç†ä¸­...&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token comment">// âŒ å¿˜è®°è°ƒç”¨next(),è¯·æ±‚ä¼šæŒ‚èµ·</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// æ­£ç¡®åšæ³•</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;å¤„ç†ä¸­...&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// âœ… å¿…é¡»è°ƒç”¨next()ç»§ç»­å¤„ç†</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// é”™è¯¯:next()åå‘é€å“åº”</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&#39;Hello&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// âŒ next()åä¸åº”å‘é€å“åº”</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// æ­£ç¡®:å“åº”åä¸è°ƒç”¨next()</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span>someCondition<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&#39;Hello&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// âœ… å‘é€å“åº”,ä¸è°ƒç”¨next()</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// âœ… ä¸å‘é€å“åº”,è°ƒç”¨next()</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ğŸ¯ <strong>å®é™…åº”ç”¨åœºæ™¯</strong>:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// åœºæ™¯1:è¯·æ±‚æ—¥å¿—è®°å½•</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">[</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span><span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">] </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>req<span class="token punctuation">.</span>method<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>req<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// è®°å½•åç»§ç»­å¤„ç†</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// åœºæ™¯2:è®¾ç½®å“åº”å¤´</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&#39;X-Powered-By&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;Express&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&#39;X-Content-Type-Options&#39;</span><span class="token punctuation">,</span> <span class="token string">&#39;nosniff&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// åœºæ™¯3:è¯·æ±‚è®¡æ—¶</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  req<span class="token punctuation">.</span>startTime <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;finish&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> duration <span class="token operator">=</span> Date<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-</span> req<span class="token punctuation">.</span>startTime<span class="token punctuation">;</span></span>
<span class="line">    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">è¯·æ±‚è€—æ—¶: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>duration<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ms</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// åœºæ™¯4:è¯·æ±‚IDç”Ÿæˆ</span></span>
<span class="line"><span class="token keyword">const</span> <span class="token punctuation">{</span> <span class="token literal-property property">v4</span><span class="token operator">:</span> uuidv4 <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&#39;uuid&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  req<span class="token punctuation">.</span>id <span class="token operator">=</span> <span class="token function">uuidv4</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ä¸ºæ¯ä¸ªè¯·æ±‚ç”Ÿæˆå”¯ä¸€ID</span></span>
<span class="line">  res<span class="token punctuation">.</span><span class="token function">setHeader</span><span class="token punctuation">(</span><span class="token string">&#39;X-Request-ID&#39;</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// åœºæ™¯5:æ€§èƒ½ç›‘æ§</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> start <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token function">hrtime</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  res<span class="token punctuation">.</span><span class="token function">on</span><span class="token punctuation">(</span><span class="token string">&#39;finish&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> <span class="token punctuation">[</span>seconds<span class="token punctuation">,</span> nanoseconds<span class="token punctuation">]</span> <span class="token operator">=</span> process<span class="token punctuation">.</span><span class="token function">hrtime</span><span class="token punctuation">(</span>start<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">const</span> duration <span class="token operator">=</span> seconds <span class="token operator">*</span> <span class="token number">1000</span> <span class="token operator">+</span> nanoseconds <span class="token operator">/</span> <span class="token number">1000000</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span>duration <span class="token operator">&gt;</span> <span class="token number">1000</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">\`</span><span class="token string">æ…¢è¯·æ±‚: </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>req<span class="token punctuation">.</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string"> (</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">\${</span>duration<span class="token punctuation">.</span><span class="token function">toFixed</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">ms)</span><span class="token template-punctuation string">\`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><ul><li>ä¸Šé¢ä»£ç çš„nextå°±æ˜¯ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ã€‚å¦‚æœå®ƒå¸¦æœ‰å‚æ•°ï¼Œåˆ™ä»£è¡¨æŠ›å‡ºä¸€ä¸ªé”™è¯¯ï¼Œå‚æ•°ä¸ºé”™è¯¯æ–‡æœ¬</li><li>æŠ›å‡ºé”™è¯¯ä»¥åï¼Œåé¢çš„ä¸­é—´ä»¶å°†ä¸å†æ‰§è¡Œï¼Œç›´åˆ°å‘ç°ä¸€ä¸ªé”™è¯¯å¤„ç†å‡½æ•°ä¸ºæ­¢</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token keyword">function</span> <span class="token function">uselessMiddleware</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token function">next</span><span class="token punctuation">(</span><span class="token string">&#39;å‡ºé”™äº†ï¼&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ä¼ é€’é”™è¯¯ç»™next(),è·³è¿‡æ™®é€šä¸­é—´ä»¶,ç›´æ¥åˆ°é”™è¯¯å¤„ç†ä¸­é—´ä»¶</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>ğŸ“Š <strong>è¿è¡Œæ•ˆæœ</strong>:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">// æ™®é€šä¸­é—´ä»¶1 â†’ è°ƒç”¨next(&#39;å‡ºé”™äº†!&#39;) â†’ è·³è¿‡ä¸­é—´ä»¶2 â†’ è·³è¿‡ä¸­é—´ä»¶3 â†’ é”™è¯¯å¤„ç†ä¸­é—´ä»¶</span>
<span class="line">// é”™è¯¯å¤„ç†ä¸­é—´ä»¶: app.use((err, req, res, next) =&gt; { ... })</span>
<span class="line">// å¦‚æœæ²¡æœ‰é”™è¯¯å¤„ç†ä¸­é—´ä»¶,Expressä¼šä½¿ç”¨é»˜è®¤çš„é”™è¯¯å¤„ç†å™¨</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>âš ï¸ <strong>æ³¨æ„äº‹é¡¹</strong>:</p><ul><li><strong>é”™è¯¯ä¸­é—´ä»¶ç­¾å</strong>: é”™è¯¯å¤„ç†ä¸­é—´ä»¶å¿…é¡»æœ‰4ä¸ªå‚æ•°(err, req, res, next)</li><li><strong>ä¸­é—´ä»¶ä½ç½®</strong>: é”™è¯¯å¤„ç†ä¸­é—´ä»¶åº”è¯¥æ”¾åœ¨æ‰€æœ‰å…¶ä»–ä¸­é—´ä»¶ä¹‹å</li><li><strong>å¼‚æ­¥é”™è¯¯</strong>: å¼‚æ­¥æ“ä½œä¸­çš„é”™è¯¯éœ€è¦æ‰‹åŠ¨ä¼ é€’ç»™next()</li><li><strong>é”™è¯¯ä¼ æ’­</strong>: è°ƒç”¨next(err)å,åªæœ‰é”™è¯¯å¤„ç†ä¸­é—´ä»¶ä¼šè¢«æ‰§è¡Œ</li><li><strong>é”™è¯¯å¯¹è±¡</strong>: å¯ä»¥ä¼ é€’å­—ç¬¦ä¸²æˆ–Errorå¯¹è±¡,å»ºè®®ä½¿ç”¨Errorå¯¹è±¡</li></ul><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// å¸¸è§é”™è¯¯:é”™è¯¯å¤„ç†ä¸­é—´ä»¶å‚æ•°ä¸è¶³</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token comment">// âŒ åªæœ‰3ä¸ªå‚æ•°,ä¸ä¼šè¢«è¯†åˆ«ä¸ºé”™è¯¯å¤„ç†å™¨</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;é”™è¯¯:&#39;</span><span class="token punctuation">,</span> req<span class="token punctuation">.</span>error<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>  <span class="token comment">// âœ… 4ä¸ªå‚æ•°,æ­£ç¡®çš„é”™è¯¯å¤„ç†å™¨</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">&#39;é”™è¯¯:&#39;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span><span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token string">&#39;æœåŠ¡å™¨é”™è¯¯&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// é”™è¯¯:å¼‚æ­¥é”™è¯¯æœªæ•è·</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// âŒ å¦‚æœfetchData()å¤±è´¥,é”™è¯¯ä¸ä¼šè¢«æ•è·</span></span>
<span class="line">  res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// æ­£ç¡®:æ•è·å¼‚æ­¥é”™è¯¯</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> data <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">fetchData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// âœ… å°†å¼‚æ­¥é”™è¯¯ä¼ é€’ç»™é”™è¯¯å¤„ç†å™¨</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ğŸ¯ <strong>å®é™…åº”ç”¨åœºæ™¯</strong>:</p><div class="language-javascript line-numbers-mode" data-highlighter="prismjs" data-ext="js"><pre><code class="language-javascript"><span class="line"><span class="token comment">// åœºæ™¯1:æ•°æ®åº“é”™è¯¯å¤„ç†</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;/user/:id&#39;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">try</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> user <span class="token operator">=</span> <span class="token keyword">await</span> User<span class="token punctuation">.</span><span class="token function">findById</span><span class="token punctuation">(</span>req<span class="token punctuation">.</span>params<span class="token punctuation">.</span>id<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token keyword">const</span> err <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#39;ç”¨æˆ·ä¸å­˜åœ¨&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">      err<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span></span>
<span class="line">      <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ä¼ é€’404é”™è¯¯</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">    res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ä¼ é€’æ•°æ®åº“é”™è¯¯</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// åœºæ™¯2:æƒé™éªŒè¯é”™è¯¯</span></span>
<span class="line"><span class="token keyword">function</span> <span class="token function">requireAuth</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>headers<span class="token punctuation">.</span>authorization<span class="token punctuation">)</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token keyword">const</span> err <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#39;æœªæˆæƒ&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">    err<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">401</span><span class="token punctuation">;</span></span>
<span class="line">    <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token punctuation">}</span></span>
<span class="line">  <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// åœºæ™¯3:å¼€å‘ç¯å¢ƒvsç”Ÿäº§ç¯å¢ƒé”™è¯¯æ ¼å¼</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> isDev <span class="token operator">=</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">&#39;development&#39;</span><span class="token punctuation">;</span></span>
<span class="line">  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>status <span class="token operator">||</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">message</span><span class="token operator">:</span> err<span class="token punctuation">.</span>message<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">error</span><span class="token operator">:</span> isDev <span class="token operator">?</span> err <span class="token operator">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>  <span class="token comment">// å¼€å‘ç¯å¢ƒè¿”å›å®Œæ•´é”™è¯¯,ç”Ÿäº§ç¯å¢ƒéšè—</span></span>
<span class="line">    <span class="token literal-property property">stack</span><span class="token operator">:</span> isDev <span class="token operator">?</span> err<span class="token punctuation">.</span>stack <span class="token operator">:</span> <span class="token keyword">undefined</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// åœºæ™¯4:é”™è¯¯æ—¥å¿—è®°å½•</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&#39;[é”™è¯¯]&#39;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">message</span><span class="token operator">:</span> err<span class="token punctuation">.</span>message<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">url</span><span class="token operator">:</span> req<span class="token punctuation">.</span>url<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">method</span><span class="token operator">:</span> req<span class="token punctuation">.</span>method<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">ip</span><span class="token operator">:</span> req<span class="token punctuation">.</span>ip<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">userAgent</span><span class="token operator">:</span> req<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&#39;user-agent&#39;</span><span class="token punctuation">)</span><span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">stack</span><span class="token operator">:</span> err<span class="token punctuation">.</span>stack<span class="token punctuation">,</span></span>
<span class="line">    <span class="token literal-property property">timestamp</span><span class="token operator">:</span> <span class="token keyword">new</span> <span class="token class-name">Date</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toISOString</span><span class="token punctuation">(</span><span class="token punctuation">)</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">// ç»§ç»­ä¼ é€’ç»™ä¸‹ä¸€ä¸ªé”™è¯¯å¤„ç†å™¨</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// åœºæ™¯5:404é”™è¯¯å¤„ç†</span></span>
<span class="line"><span class="token comment">// æ”¾åœ¨æ‰€æœ‰è·¯ç”±ä¹‹å</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  <span class="token keyword">const</span> err <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Error</span><span class="token punctuation">(</span><span class="token string">&#39;é¡µé¢æœªæ‰¾åˆ°&#39;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  err<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">404</span><span class="token punctuation">;</span></span>
<span class="line">  <span class="token function">next</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span>
<span class="line"><span class="token comment">// æœ€ç»ˆçš„é”™è¯¯å¤„ç†å™¨</span></span>
<span class="line">app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> req<span class="token punctuation">,</span> res<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span></span>
<span class="line">  res<span class="token punctuation">.</span><span class="token function">status</span><span class="token punctuation">(</span>err<span class="token punctuation">.</span>status <span class="token operator">||</span> <span class="token number">500</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line">  res<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">{</span></span>
<span class="line">    <span class="token literal-property property">error</span><span class="token operator">:</span> <span class="token punctuation">{</span></span>
<span class="line">      <span class="token literal-property property">message</span><span class="token operator">:</span> err<span class="token punctuation">.</span>message<span class="token punctuation">,</span></span>
<span class="line">      <span class="token literal-property property">status</span><span class="token operator">:</span> err<span class="token punctuation">.</span>status <span class="token operator">||</span> <span class="token number">500</span></span>
<span class="line">    <span class="token punctuation">}</span></span>
<span class="line">  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></blockquote><h2 id="_3-express-æ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#_3-express-æ–¹æ³•"><span>3.Express æ–¹æ³•</span></a></h2><p><strong>Expressè·¯ç”±ç®€ä»‹</strong></p><p>è·¯ç”±è¡¨ç¤ºåº”ç”¨ç¨‹åºç«¯ç‚¹ (URI) çš„å®šä¹‰ä»¥åŠå“åº”å®¢æˆ·ç«¯è¯·æ±‚çš„æ–¹å¼ã€‚å®ƒåŒ…å«ä¸€ä¸ªè¯·æ±‚æ–¹æ—¶ï¼ˆmethodsï¼‰ã€è·¯å¾„ï¼ˆpathï¼‰å’Œè·¯ç”±åŒ¹é…æ—¶çš„å‡½æ•°ï¼ˆcallbackï¼‰;</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">app.methods(path, callback);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>Expressè·¯ç”±æ–¹æ³•</strong></p><p>Expressæ–¹æ³•æºäº HTTP æ–¹æ³•ä¹‹ä¸€ï¼Œé™„åŠ åˆ° express ç±»çš„å®ä¾‹ã€‚å®ƒå¯è¯·æ±‚çš„æ–¹æ³•åŒ…æ‹¬ï¼š</p><p>getã€postã€putã€headã€deleteã€optionsã€traceã€copyã€lockã€mkcolã€moveã€purgeã€propfindã€proppatchã€unlockã€reportã€mkactivityã€checkoutã€mergeã€m-searchã€notifyã€subscribeã€unsubscribeã€patchã€search å’Œ connectã€‚</p><blockquote><p>è·¯ç”±æ˜¯æŒ‡å¦‚ä½•å®šä¹‰åº”ç”¨çš„ç«¯ç‚¹ï¼ˆURIsï¼‰ä»¥åŠå¦‚ä½•å“åº”å®¢æˆ·ç«¯çš„è¯·æ±‚ã€‚</p><p>è·¯ç”±æ˜¯ç”±ä¸€ä¸ª URIã€HTTP è¯·æ±‚ï¼ˆGETã€POSTç­‰ï¼‰å’Œè‹¥å¹²ä¸ªå¥æŸ„ç»„æˆï¼Œå®ƒçš„ç»“æ„å¦‚ä¸‹ï¼š app.METHOD(path, [callback...], callback)ï¼Œ app æ˜¯ express å¯¹è±¡çš„ä¸€ä¸ªå®ä¾‹ï¼Œ METHOD æ˜¯ä¸€ä¸ª HTTP è¯·æ±‚æ–¹æ³•ï¼Œ path æ˜¯æœåŠ¡å™¨ä¸Šçš„è·¯å¾„ï¼Œ callback æ˜¯å½“è·¯ç”±åŒ¹é…æ—¶è¦æ‰§è¡Œçš„å‡½æ•°ã€‚</p></blockquote><p>ä¸‹é¢æ˜¯ä¸€ä¸ªåŸºæœ¬çš„è·¯ç”±ç¤ºä¾‹ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">var express = require(&#39;express&#39;);</span>
<span class="line">var app = express();</span>
<span class="line"></span>
<span class="line">// respond with &quot;hello world&quot; when a GET request is made to the homepage</span>
<span class="line">app.get(&#39;/&#39;, function(req, res) {</span>
<span class="line">  //å†™å®Œä¸€ä¸ªsendï¼Œåé¢æ‰€æœ‰è·Ÿè·¯ç”±æœ‰å…³çš„éƒ½ä¸ä¼šæ‰§è¡Œ</span>
<span class="line">  //ä¼šè‡ªåŠ¨å“åº”å¯¹åº”çš„æ•°æ®ç±»å‹</span>
<span class="line">  //   res.send([1, 2, 3]);</span>
<span class="line">  //   res.send({ ok: 1 });</span>
<span class="line">  //   res.json({ ok: 1 });</span>
<span class="line">   // ä½¿ç”¨æ··åˆä½¿ç”¨å‡½æ•°æ•°ç»„å¤„ç†æ—¶å¦‚æœå‰é¢æœ‰res.send();é‚£ä¹ˆåé¢å’Œè·¯ç”±å¤„ç†ç›¸å…³ä»£ç éƒ½ä¸ç”Ÿæ•ˆ</span>
<span class="line">  res.send(&#39;hello world&#39;);</span>
<span class="line">  res.send(\`</span>
<span class="line">        &lt;html&gt;</span>
<span class="line">            &lt;h1&gt;hello world&lt;/h2&gt;</span>
<span class="line">        &lt;/html&gt;</span>
<span class="line">    \`);</span>
<span class="line">});</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è·¯ç”±è·¯å¾„å’Œè¯·æ±‚æ–¹æ³•ä¸€èµ·å®šä¹‰äº†è¯·æ±‚çš„ç«¯ç‚¹ï¼Œå®ƒå¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€å­—ç¬¦ä¸²æ¨¡å¼æˆ–è€…æ­£åˆ™è¡¨è¾¾å¼ã€‚</p><p><strong>allæ–¹æ³•å’ŒHTTPåŠ¨è¯æ–¹æ³•</strong></p><blockquote><p>é’ˆå¯¹ä¸åŒçš„è¯·æ±‚ï¼ŒExpressæä¾›äº†useæ–¹æ³•çš„ä¸€äº›åˆ«åã€‚æ¯”å¦‚ï¼Œä¸Šé¢ä»£ç ä¹Ÿå¯ä»¥ç”¨åˆ«åçš„å½¢å¼æ¥å†™</p></blockquote><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">var express = require(&quot;express&quot;);</span>
<span class="line">var http = require(&quot;http&quot;);</span>
<span class="line">var app = express();</span>
<span class="line"></span>
<span class="line">app.all(&quot;*&quot;, function(request, response, next) {</span>
<span class="line">  response.writeHead(200, { &quot;Content-Type&quot;: &quot;text/plain&quot; });</span>
<span class="line">  next();</span>
<span class="line">});</span>
<span class="line"></span>
<span class="line">app.get(&quot;/&quot;, function(request, response) {</span>
<span class="line">  response.end(&quot;Welcome to the homepage!&quot;);</span>
<span class="line">});</span>
<span class="line"></span>
<span class="line">app.get(&quot;/about&quot;, function(request, response) {</span>
<span class="line">  response.end(&quot;Welcome to the about page!&quot;);</span>
<span class="line">});</span>
<span class="line"></span>
<span class="line">app.get(&quot;*&quot;, function(request, response) {</span>
<span class="line">  response.end(&quot;404!&quot;);</span>
<span class="line">});</span>
<span class="line"></span>
<span class="line">http.createServer(app).listen(1337);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><ul><li>ä¸Šé¢ä»£ç çš„allæ–¹æ³•è¡¨ç¤ºï¼Œæ‰€æœ‰è¯·æ±‚éƒ½å¿…é¡»é€šè¿‡è¯¥ä¸­é—´ä»¶ï¼Œå‚æ•°ä¸­çš„â€œ*â€è¡¨ç¤ºå¯¹æ‰€æœ‰è·¯å¾„æœ‰æ•ˆã€‚getæ–¹æ³•åˆ™æ˜¯åªæœ‰GETåŠ¨è¯çš„HTTPè¯·æ±‚é€šè¿‡è¯¥ä¸­é—´ä»¶ï¼Œå®ƒçš„ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¯·æ±‚çš„è·¯å¾„ã€‚ç”±äºgetæ–¹æ³•çš„å›è°ƒå‡½æ•°æ²¡æœ‰è°ƒç”¨nextæ–¹æ³•ï¼Œæ‰€ä»¥åªè¦æœ‰ä¸€ä¸ªä¸­é—´ä»¶è¢«è°ƒç”¨äº†ï¼Œåé¢çš„ä¸­é—´ä»¶å°±ä¸ä¼šå†è¢«è°ƒç”¨äº†</li><li>é™¤äº†getæ–¹æ³•ä»¥å¤–ï¼ŒExpressè¿˜æä¾›postã€putã€deleteæ–¹æ³•ï¼Œå³HTTPåŠ¨è¯éƒ½æ˜¯Expressçš„æ–¹æ³•</li></ul></blockquote><ul><li>é™¤äº†getæ–¹æ³•ä»¥å¤–ï¼ŒExpressè¿˜æä¾›postã€putã€deleteæ–¹æ³•ï¼Œå³HTTPåŠ¨è¯éƒ½æ˜¯Expressçš„æ–¹æ³•</li><li>è¿™äº›æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œéƒ½æ˜¯è¯·æ±‚çš„è·¯å¾„ã€‚é™¤äº†ç»å¯¹åŒ¹é…ä»¥å¤–ï¼ŒExpresså…è®¸æ¨¡å¼åŒ¹é…</li></ul><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">app.get(&quot;/hello/:who&quot;, function(req, res) {</span>
<span class="line">  res.end(&quot;Hello, &quot; + req.params.who + &quot;.&quot;);</span>
<span class="line">});</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_4-è·¯å¾„åŒ¹é…" tabindex="-1"><a class="header-anchor" href="#_4-è·¯å¾„åŒ¹é…"><span>4.è·¯å¾„åŒ¹é…</span></a></h2><h3 id="_4-1-å­—ç¬¦ä¸²è·¯å¾„" tabindex="-1"><a class="header-anchor" href="#_4-1-å­—ç¬¦ä¸²è·¯å¾„"><span>4.1 å­—ç¬¦ä¸²è·¯å¾„</span></a></h3><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">// åŒ¹é…æ ¹è·¯å¾„çš„è¯·æ±‚</span>
<span class="line">app.get(&#39;/&#39;, function (req, res) {</span>
<span class="line">  res.send(&#39;root&#39;);</span>
<span class="line">});</span>
<span class="line"></span>
<span class="line">// åŒ¹é… /about è·¯å¾„çš„è¯·æ±‚</span>
<span class="line">app.get(&#39;/about&#39;, function (req, res) {</span>
<span class="line">  res.send(&#39;about&#39;);</span>
<span class="line">});</span>
<span class="line"></span>
<span class="line">// åŒ¹é… /random.text è·¯å¾„çš„è¯·æ±‚</span>
<span class="line">app.get(&#39;/random.text&#39;, function (req, res) {</span>
<span class="line">  res.send(&#39;random.text&#39;);</span>
<span class="line">});</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-2-å­—ç¬¦ä¸²æ¨¡å¼è·¯å¾„" tabindex="-1"><a class="header-anchor" href="#_4-2-å­—ç¬¦ä¸²æ¨¡å¼è·¯å¾„"><span>4.2 å­—ç¬¦ä¸²æ¨¡å¼è·¯å¾„</span></a></h3><p>ä½¿ç”¨å­—ç¬¦ä¸²æ¨¡å¼çš„è·¯ç”±è·¯å¾„ç¤ºä¾‹ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">// åŒ¹é… acd å’Œ abcd</span>
<span class="line">app.get(&#39;/ab?cd&#39;, function(req, res) {</span>
<span class="line">  res.send(&#39;ab?cd&#39;);</span>
<span class="line">});</span>
<span class="line"></span>
<span class="line">// åŒ¹é… abcdã€abbcdã€abbbcdç­‰</span>
<span class="line">app.get(&#39;/ab+cd&#39;, function(req, res) {</span>
<span class="line">  res.send(&#39;ab+cd&#39;);</span>
<span class="line">});</span>
<span class="line"></span>
<span class="line">// åŒ¹é… abcdã€abxcdã€abRABDOMcdã€ab123cdç­‰</span>
<span class="line">app.get(&#39;/ab*cd&#39;, function(req, res) {</span>
<span class="line">  res.send(&#39;ab*cd&#39;);</span>
<span class="line">});</span>
<span class="line"></span>
<span class="line">// åŒ¹é… /abe å’Œ /abcde</span>
<span class="line">app.get(&#39;/ab(cd)?e&#39;, function(req, res) {</span>
<span class="line"> res.send(&#39;ab(cd)?e&#39;);</span>
<span class="line">});</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_4-3-æ­£åˆ™è¡¨è¾¾å¼è·¯å¾„" tabindex="-1"><a class="header-anchor" href="#_4-3-æ­£åˆ™è¡¨è¾¾å¼è·¯å¾„"><span>4.3 æ­£åˆ™è¡¨è¾¾å¼è·¯å¾„</span></a></h3><p>ä½¿ç”¨æ­£åˆ™è¡¨è¾¾å¼çš„è·¯ç”±è·¯å¾„ç¤ºä¾‹ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">// åŒ¹é…ä»»ä½•è·¯å¾„ä¸­å«æœ‰ a çš„è·¯å¾„ï¼š</span>
<span class="line">app.get(/a/, function(req, res) {</span>
<span class="line">  res.send(&#39;/a/&#39;);</span>
<span class="line">});</span>
<span class="line"></span>
<span class="line">// åŒ¹é… butterflyã€dragonflyï¼Œä¸åŒ¹é… butterflymanã€dragonfly manç­‰</span>
<span class="line">app.get(/.*fly$/, function(req, res) {</span>
<span class="line">  res.send(&#39;/.*fly$/&#39;);</span>
<span class="line">});</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯ä»¥ä¸ºè¯·æ±‚å¤„ç†æä¾›å¤šä¸ªå›è°ƒå‡½æ•°ï¼Œå…¶è¡Œä¸ºç±»ä¼¼ ä¸­é—´ä»¶ã€‚å”¯ä¸€çš„åŒºåˆ«æ˜¯è¿™äº›å›è°ƒå‡½æ•°æœ‰å¯èƒ½è°ƒç”¨ next(&#39;route&#39;) æ–¹æ³•è€Œç•¥è¿‡å…¶ä»–è·¯ç”±å›è°ƒå‡½æ•°ã€‚å¯ä»¥åˆ©ç”¨è¯¥æœºåˆ¶ä¸ºè·¯ç”±å®šä¹‰å‰ææ¡ä»¶ï¼Œå¦‚æœåœ¨ç°æœ‰è·¯å¾„ä¸Šç»§ç»­æ‰§è¡Œæ²¡æœ‰æ„ä¹‰ï¼Œåˆ™å¯å°†æ§åˆ¶æƒäº¤ç»™å‰©ä¸‹çš„è·¯å¾„ã€‚</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">app.get(&#39;/example/a&#39;, function (req, res) {</span>
<span class="line">  res.send(&#39;Hello from A!&#39;);</span>
<span class="line">});</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨å¤šä¸ªå›è°ƒå‡½æ•°å¤„ç†è·¯ç”±ï¼ˆè®°å¾—æŒ‡å®š next å¯¹è±¡ï¼‰ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">app.get(&#39;/example/b&#39;, function (req, res, next) {</span>
<span class="line">  console.log(&#39;response will be sent by the next function ...&#39;);</span>
<span class="line">  next();</span>
<span class="line">}, function (req, res) {</span>
<span class="line">  res.send(&#39;Hello from B!&#39;);</span>
<span class="line">});</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ä½¿ç”¨å›è°ƒå‡½æ•°æ•°ç»„å¤„ç†è·¯ç”±ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">var cb0 = function (req, res, next) {</span>
<span class="line">  console.log(&#39;CB0&#39;)</span>
<span class="line">  next()</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">var cb1 = function (req, res, next) {</span>
<span class="line">  console.log(&#39;CB1&#39;)</span>
<span class="line">  next()</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">var cb2 = function (req, res) {</span>
<span class="line">  res.send(&#39;Hello from C!&#39;)</span>
<span class="line">}</span>
<span class="line"></span>
<span class="line">app.get(&#39;/example/c&#39;, [cb0, cb1, cb2])</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_5-responseå¯¹è±¡" tabindex="-1"><a class="header-anchor" href="#_5-responseå¯¹è±¡"><span>5.responseå¯¹è±¡</span></a></h2><table><thead><tr><th>æ–¹æ³•</th><th>æè¿°</th></tr></thead><tbody><tr><td><a href="http://www.expressjs.com.cn/en/4x/api.html#res.download" target="_blank" rel="noopener noreferrer">res.download()</a></td><td>æç¤ºè¦ä¸‹è½½çš„æ–‡ä»¶ã€‚</td></tr><tr><td><a href="http://www.expressjs.com.cn/en/4x/api.html#res.end" target="_blank" rel="noopener noreferrer">res.endï¼ˆï¼‰</a></td><td>ç»“æŸå“åº”è¿‡ç¨‹ã€‚</td></tr><tr><td><a href="http://www.expressjs.com.cn/en/4x/api.html#res.json" target="_blank" rel="noopener noreferrer">res.jsonï¼ˆï¼‰</a></td><td>å‘é€JSONå“åº”ã€‚</td></tr><tr><td><a href="http://www.expressjs.com.cn/en/4x/api.html#res.jsonp" target="_blank" rel="noopener noreferrer">res.jsonpï¼ˆï¼‰</a></td><td>å‘é€å¸¦æœ‰JSONPæ”¯æŒçš„JSONå“åº”ã€‚</td></tr><tr><td><a href="http://www.expressjs.com.cn/en/4x/api.html#res.redirect" target="_blank" rel="noopener noreferrer">res.redirectï¼ˆï¼‰</a></td><td>é‡å®šå‘è¯·æ±‚ã€‚</td></tr><tr><td><a href="http://www.expressjs.com.cn/en/4x/api.html#res.render" target="_blank" rel="noopener noreferrer">res.renderï¼ˆï¼‰</a></td><td>æ¸²æŸ“è§†å›¾æ¨¡æ¿ã€‚</td></tr><tr><td><a href="http://www.expressjs.com.cn/en/4x/api.html#res.send" target="_blank" rel="noopener noreferrer">res.sendï¼ˆï¼‰</a></td><td>å‘é€å„ç§ç±»å‹çš„å“åº”ã€‚</td></tr><tr><td><a href="http://www.expressjs.com.cn/en/4x/api.html#res.sendFile" target="_blank" rel="noopener noreferrer">res.sendFileï¼ˆï¼‰</a></td><td>å°†æ–‡ä»¶ä½œä¸ºå…«ä½å­—èŠ‚æµå‘é€ã€‚</td></tr><tr><td><a href="http://www.expressjs.com.cn/en/4x/api.html#res.sendStatus" target="_blank" rel="noopener noreferrer">res.sendStatusï¼ˆï¼‰</a></td><td>è®¾ç½®å“åº”çŠ¶æ€ä»£ç ï¼Œå¹¶å°†å…¶å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼å‘é€ä¸ºå“åº”æ­£æ–‡ã€‚</td></tr></tbody></table><p>ä¾‹ï¼š</p><p><strong>ï¼ˆ1ï¼‰response.redirectæ–¹æ³•</strong></p><blockquote><p>response.redirectæ–¹æ³•å…è®¸ç½‘å€çš„é‡å®šå‘</p></blockquote><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">response.redirect(&quot;/hello/anime&quot;);</span>
<span class="line">response.redirect(&quot;http://www.example.com&quot;);</span>
<span class="line">response.redirect(301, &quot;http://www.example.com&quot;); </span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>ï¼ˆ2ï¼‰response.sendFileæ–¹æ³•</strong></p><blockquote><p>response.sendFileæ–¹æ³•ç”¨äºå‘é€æ–‡ä»¶</p></blockquote><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">response.sendFile(&quot;/path/to/anime.mp4&quot;);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p><strong>ï¼ˆ3ï¼‰response.renderæ–¹æ³•</strong></p><blockquote><p>response.renderæ–¹æ³•ç”¨äºæ¸²æŸ“ç½‘é¡µæ¨¡æ¿ã€‚</p></blockquote><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">//  ä½¿ç”¨renderæ–¹æ³•ï¼Œå°†messageå˜é‡ä¼ å…¥indexæ¨¡æ¿ï¼Œæ¸²æŸ“æˆHTMLç½‘é¡µ</span>
<span class="line">app.get(&quot;/&quot;, function(request, response) {</span>
<span class="line">  response.render(&quot;index&quot;, { message: &quot;Hello World&quot; });</span>
<span class="line">});</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_6-è·¯çº¿å¤„ç†ç¨‹åº" tabindex="-1"><a class="header-anchor" href="#_6-è·¯çº¿å¤„ç†ç¨‹åº"><span>6.è·¯çº¿å¤„ç†ç¨‹åº</span></a></h2><p>æ‚¨å¯ä»¥æä¾›è¡Œä¸ºç±»ä¼¼äº<a href="http://www.expressjs.com.cn/en/guide/using-middleware.html" target="_blank" rel="noopener noreferrer">ä¸­é—´ä»¶çš„</a>å¤šä¸ªå›è°ƒå‡½æ•°æ¥å¤„ç†è¯·æ±‚ã€‚å”¯ä¸€çš„ä¾‹å¤–æ˜¯è¿™äº›å›è°ƒå¯èƒ½ä¼šè°ƒç”¨<code>next(&#39;route&#39;)</code>ä»¥ç»•è¿‡å…¶ä½™çš„è·¯ç”±å›è°ƒã€‚æ‚¨å¯ä»¥ä½¿ç”¨æ­¤æœºåˆ¶åœ¨è·¯ç”±ä¸Šæ–½åŠ å…ˆå†³æ¡ä»¶ï¼Œç„¶ååœ¨æ²¡æœ‰ç†ç”±ç»§ç»­ä½¿ç”¨å½“å‰è·¯ç”±çš„æƒ…å†µä¸‹å°†æ§åˆ¶æƒä¼ é€’ç»™åç»­è·¯ç”±ã€‚</p><p>å¤šä¸ªå›è°ƒå‡½æ•°å¯ä»¥å¤„ç†ä¸€æ¡è·¯ç”±ï¼ˆç¡®ä¿æŒ‡å®šäº†<code>next</code>å¯¹è±¡ï¼‰ã€‚ä¾‹å¦‚ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">app.get(&#39;/example/b&#39;, function (req, res, next) {</span>
<span class="line">  console.log(&#39;the response will be sent by the next function ...&#39;)</span>
<span class="line">  next()</span>
<span class="line">}, function (req, res) {</span>
<span class="line">  res.send(&#39;Hello from B!&#39;)</span>
<span class="line">})</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ··åˆä½¿ç”¨å‡½æ•°å’Œå‡½æ•°æ•°ç»„å¤„ç†è·¯ç”±ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">const fun1 = (req, res, next) =&gt; {</span>
<span class="line">  // éªŒè¯ç”¨æˆ·tokenè¿‡æœŸ, cookieè¿‡æœŸ</span>
<span class="line">  console.log(&#39;tokenéªŒè¯&#39;);</span>
<span class="line">  let isValid = true;</span>
<span class="line">  if (isValid) {</span>
<span class="line">    next();</span>
<span class="line">  } else {</span>
<span class="line">    //å°†ç¬¬ä¸€ä¸ªä¸­é—´ä»¶çš„æ•°æ®ä¼ è¾“åˆ°ç¬¬äºŒä¸ªä¸­é—´ä»¶</span>
<span class="line">    res.name = &quot;dselegent&quot;;</span>
<span class="line">    res.send(&#39;error&#39;);</span>
<span class="line">  }</span>
<span class="line">};</span>
<span class="line">const fun2 = (req, res) =&gt; {</span>
<span class="line">   console.log(res.name)</span>
<span class="line">  res.send(&#39;home&#39;);</span>
<span class="line">};</span>
<span class="line">app.get(&#39;/home&#39;, [fun1, fun2]);</span>
<span class="line"></span>
<span class="line">app.get(&#39;/list&#39;, fun1, (req, res) =&gt; {</span>
<span class="line">  res.send(&#39;list&#39;);</span>
<span class="line">});</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_7-ä¸­é—´ä»¶" tabindex="-1"><a class="header-anchor" href="#_7-ä¸­é—´ä»¶"><span>7.ä¸­é—´ä»¶</span></a></h2><p>Express æ˜¯ä¸€ä¸ªè‡ªèº«åŠŸèƒ½æç®€ï¼Œå®Œå…¨æ˜¯ç”±è·¯ç”±å’Œä¸­é—´ä»¶æ„æˆä¸€ä¸ªçš„ web å¼€å‘æ¡†æ¶ï¼šä»æœ¬è´¨ä¸Šæ¥è¯´ï¼Œä¸€ä¸ª Express åº”ç”¨å°±æ˜¯åœ¨è°ƒç”¨å„ç§ä¸­é—´ä»¶ã€‚</p><p>ä¸­é—´ä»¶ï¼ˆMiddlewareï¼‰ æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå¯ä»¥è®¿é—®è¯·æ±‚å¯¹è±¡ï¼ˆrequest object (req)ï¼‰, å“åº”å¯¹è±¡ï¼ˆresponse object (res)ï¼‰, å’Œ web åº”ç”¨ä¸­å¤„äºè¯·æ±‚-å“åº”å¾ªç¯æµç¨‹ä¸­çš„ä¸­é—´ä»¶ï¼Œä¸€èˆ¬è¢«å‘½åä¸º next çš„å˜é‡ã€‚</p><p>ä¸­é—´ä»¶çš„åŠŸèƒ½åŒ…æ‹¬ï¼š</p><ul><li>æ‰§è¡Œä»»ä½•ä»£ç ã€‚</li><li>ä¿®æ”¹è¯·æ±‚å’Œå“åº”å¯¹è±¡ã€‚</li><li>ç»ˆç»“è¯·æ±‚-å“åº”å¾ªç¯ã€‚</li><li>è°ƒç”¨å †æ ˆä¸­çš„ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ã€‚</li></ul><p>å¦‚æœå½“å‰ä¸­é—´ä»¶æ²¡æœ‰ç»ˆç»“è¯·æ±‚-å“åº”å¾ªç¯ï¼Œåˆ™å¿…é¡»è°ƒç”¨ next() æ–¹æ³•å°†æ§åˆ¶æƒäº¤ç»™ä¸‹ä¸€ä¸ªä¸­é—´ä»¶ï¼Œå¦åˆ™è¯·æ±‚å°±ä¼šæŒ‚èµ·ã€‚</p><p>Express åº”ç”¨å¯ä½¿ç”¨å¦‚ä¸‹å‡ ç§ä¸­é—´ä»¶ï¼š</p><ul><li>åº”ç”¨çº§ä¸­é—´ä»¶</li><li>è·¯ç”±çº§ä¸­é—´ä»¶</li><li>é”™è¯¯å¤„ç†ä¸­é—´ä»¶</li><li>å†…ç½®ä¸­é—´ä»¶</li><li>ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶</li></ul><p>ä½¿ç”¨å¯é€‰åˆ™æŒ‚è½½è·¯å¾„ï¼Œå¯åœ¨åº”ç”¨çº§åˆ«æˆ–è·¯ç”±çº§åˆ«è£…è½½ä¸­é—´ä»¶ã€‚å¦å¤–ï¼Œä½ è¿˜å¯ä»¥åŒæ—¶è£…åœ¨ä¸€ç³»åˆ—ä¸­é—´ä»¶å‡½æ•°ï¼Œä»è€Œåœ¨ä¸€ä¸ªæŒ‚è½½ç‚¹ä¸Šåˆ›å»ºä¸€ä¸ªå­ä¸­é—´ä»¶æ ˆã€‚</p><h3 id="_7-1-åº”ç”¨çº§ä¸­é—´ä»¶" tabindex="-1"><a class="header-anchor" href="#_7-1-åº”ç”¨çº§ä¸­é—´ä»¶"><span>7.1 åº”ç”¨çº§ä¸­é—´ä»¶</span></a></h3><p>åº”ç”¨çº§ä¸­é—´ä»¶ç»‘å®šåˆ° app å¯¹è±¡ ä½¿ç”¨ app.use() å’Œ app.METHOD()ï¼Œ å…¶ä¸­ï¼Œ METHOD æ˜¯éœ€è¦å¤„ç†çš„ HTTP è¯·æ±‚çš„æ–¹æ³•ï¼Œä¾‹å¦‚ GET, PUT, POST ç­‰ç­‰ï¼Œå…¨éƒ¨å°å†™ã€‚ä¾‹å¦‚ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">var app = express()</span>
<span class="line">const indexRouter = require(&#39;./route/indexRouter&#39;);</span>
<span class="line">const LoginRouter = require(&#39;./route/LoginRouter&#39;);</span>
<span class="line"></span>
<span class="line">//åº”ç”¨çº§åˆ«(åé¢çš„è·¯ç”±éƒ½ä¼šæ‰§è¡Œæ­¤ä¸­é—´ä»¶)</span>
<span class="line">app.use((req, res, next) =&gt; {</span>
<span class="line">  // éªŒè¯ç”¨æˆ·tokenè¿‡æœŸ, cookieè¿‡æœŸ</span>
<span class="line">  console.log(&#39;tokenéªŒè¯&#39;);</span>
<span class="line">  let isValid = true;</span>
<span class="line">  if (isValid) {</span>
<span class="line">    next();</span>
<span class="line">  } else {</span>
<span class="line">    res.send(&#39;error&#39;);</span>
<span class="line">  }</span>
<span class="line">});</span>
<span class="line"></span>
<span class="line">//åº”ç”¨çº§åˆ«(è¿™é‡Œä¸å†™è·¯å¾„é»˜è®¤/)</span>
<span class="line">//è¿™äº›useæ–¹æ³•æ˜¯æ¯æ¬¡è®¿é—®éƒ½æ˜¯ä»ä¸Šå¾€ä¸‹æ‰§è¡Œ</span>
<span class="line">//å¦‚æœæ˜¯/login/a,ä¼šå…ˆæ‰¾åˆ°/loginå¼€å¤´çš„è¿™ä¸ªåº”ç”¨çº§ä¸­é—´ä»¶</span>
<span class="line">//ç„¶åå†è¿›å…¥è¿™ä¸ªä¸­é—´ä»¶æ‰¾/a</span>
<span class="line">app.use(indexRouter);</span>
<span class="line">app.use(&#39;/login&#39;, LoginRouter);</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-2-è·¯ç”±çº§ä¸­é—´ä»¶" tabindex="-1"><a class="header-anchor" href="#_7-2-è·¯ç”±çº§ä¸­é—´ä»¶"><span>7.2 è·¯ç”±çº§ä¸­é—´ä»¶</span></a></h3><h4 id="_7-2-1-app-route" tabindex="-1"><a class="header-anchor" href="#_7-2-1-app-route"><span>7.2.1 app.route()</span></a></h4><p>æ‚¨å¯ä»¥ä½¿ç”¨æ¥ä¸ºè·¯ç”±è·¯å¾„åˆ›å»ºå¯é“¾æ¥çš„è·¯ç”±å¤„ç†ç¨‹åº<code>app.route()</code>ã€‚ç”±äºè·¯å¾„æ˜¯åœ¨å•ä¸ªä½ç½®æŒ‡å®šçš„ï¼Œå› æ­¤åˆ›å»ºæ¨¡å—åŒ–è·¯ç”±éå¸¸æœ‰å¸®åŠ©ï¼Œå‡å°‘å†—ä½™å’Œé”™åˆ«å­—ä¹Ÿå¾ˆæœ‰å¸®åŠ©ã€‚æœ‰å…³è·¯ç”±çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ï¼š<a href="http://www.expressjs.com.cn/en/4x/api.html#router" target="_blank" rel="noopener noreferrer">Routerï¼ˆï¼‰æ–‡æ¡£</a>ã€‚</p><p>è¿™æ˜¯ä½¿ç”¨å®šä¹‰çš„é“¾å¼è·¯ç”±å¤„ç†ç¨‹åºçš„ç¤ºä¾‹<code>app.route()</code>ã€‚</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">app.route(&#39;/book&#39;)</span>
<span class="line">  .get(function (req, res) {</span>
<span class="line">    res.send(&#39; Get a random book&#39;)</span>
<span class="line">  })</span>
<span class="line">  .post(function (req, res) {</span>
<span class="line">    res.send(&#39;Add a book&#39;)</span>
<span class="line">  })</span>
<span class="line">  .put(function (req, res) {</span>
<span class="line">    res.send(&#39;Update the book&#39;)</span>
<span class="line">  })</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="_7-2-2-å¿«é€Ÿè·¯ç”±å™¨" tabindex="-1"><a class="header-anchor" href="#_7-2-2-å¿«é€Ÿè·¯ç”±å™¨"><span>7.2.2 å¿«é€Ÿè·¯ç”±å™¨</span></a></h4><p>è·¯ç”±çº§ä¸­é—´ä»¶å’Œåº”ç”¨çº§ä¸­é—´ä»¶ä¸€æ ·ï¼Œåªæ˜¯å®ƒç»‘å®šçš„å¯¹è±¡ä¸º <code>express.Router()</code>ã€‚</p><p>ä½¿ç”¨<code>express.Router</code>è¯¥ç±»åˆ›å»ºæ¨¡å—åŒ–çš„ï¼Œå¯å®‰è£…çš„è·¯ç”±å¤„ç†ç¨‹åºã€‚ä¸€ä¸ª<code>Router</code>å®ä¾‹æ˜¯ä¸€ä¸ªå®Œæ•´çš„ä¸­é—´ä»¶å’Œè·¯ç”±ç³»ç»Ÿ; å› æ­¤ï¼Œå®ƒé€šå¸¸è¢«ç§°ä¸ºâ€œè¿·ä½ åº”ç”¨ç¨‹åºâ€ã€‚</p><p>ä»¥ä¸‹ç¤ºä¾‹å°†è·¯ç”±å™¨åˆ›å»ºä¸ºæ¨¡å—ï¼Œåœ¨å…¶ä¸­åŠ è½½ä¸­é—´ä»¶åŠŸèƒ½ï¼Œå®šä¹‰ä¸€äº›è·¯ç”±ï¼Œå¹¶å°†è·¯ç”±å™¨æ¨¡å—å®‰è£…åœ¨ä¸»åº”ç”¨ç¨‹åºçš„è·¯å¾„ä¸Šã€‚</p><p><code>home.js</code>åœ¨appç›®å½•ä¸­åˆ›å»ºä¸€ä¸ªåä¸ºä»¥ä¸‹å†…å®¹çš„è·¯ç”±å™¨æ–‡ä»¶ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">var router = express.Router()</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">var app = express()</span>
<span class="line">var router = express.Router()</span>
<span class="line"></span>
<span class="line">// æ²¡æœ‰æŒ‚è½½è·¯å¾„çš„ä¸­é—´ä»¶ï¼Œé€šè¿‡è¯¥è·¯ç”±çš„æ¯ä¸ªè¯·æ±‚éƒ½ä¼šæ‰§è¡Œè¯¥ä¸­é—´ä»¶</span>
<span class="line">router.use(function (req, res, next) {</span>
<span class="line">  console.log(&#39;Time:&#39;, Date.now())</span>
<span class="line">  next()</span>
<span class="line">})</span>
<span class="line"></span>
<span class="line">// ä¸€ä¸ªä¸­é—´ä»¶æ ˆï¼Œæ˜¾ç¤ºä»»ä½•æŒ‡å‘ /user/:id çš„ HTTP è¯·æ±‚çš„ä¿¡æ¯</span>
<span class="line">router.use(&#39;/user/:id&#39;, function(req, res, next) {</span>
<span class="line">  console.log(&#39;Request URL:&#39;, req.originalUrl)</span>
<span class="line">  next()</span>
<span class="line">}, function (req, res, next) {</span>
<span class="line">  console.log(&#39;Request Type:&#39;, req.method)</span>
<span class="line">  next()</span>
<span class="line">})</span>
<span class="line"></span>
<span class="line">// ä¸€ä¸ªä¸­é—´ä»¶æ ˆï¼Œå¤„ç†æŒ‡å‘ /user/:id çš„ GET è¯·æ±‚</span>
<span class="line">router.get(&#39;/user/:id&#39;, function (req, res, next) {</span>
<span class="line">  // å¦‚æœ user id ä¸º 0, è·³åˆ°ä¸‹ä¸€ä¸ªè·¯ç”±</span>
<span class="line">  if (req.params.id == 0) next(&#39;route&#39;)</span>
<span class="line">  // è´Ÿè´£å°†æ§åˆ¶æƒäº¤ç»™æ ˆä¸­ä¸‹ä¸€ä¸ªä¸­é—´ä»¶</span>
<span class="line">  else next() //</span>
<span class="line">}, function (req, res, next) {</span>
<span class="line">  // æ¸²æŸ“å¸¸è§„é¡µé¢</span>
<span class="line">  res.render(&#39;regular&#39;)</span>
<span class="line">})</span>
<span class="line"></span>
<span class="line">// å¤„ç† /user/:idï¼Œ æ¸²æŸ“ä¸€ä¸ªç‰¹æ®Šé¡µé¢</span>
<span class="line">router.get(&#39;/user/:id&#39;, function (req, res, next) {</span>
<span class="line">  console.log(req.params.id)</span>
<span class="line">  res.render(&#39;special&#39;)</span>
<span class="line">})</span>
<span class="line"></span>
<span class="line">module.exports=  router</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç„¶åï¼Œåœ¨åº”ç”¨ç¨‹åºä¸­åŠ è½½è·¯ç”±å™¨æ¨¡å—ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">var indexRouter = require(&#39;./home&#39;)</span>
<span class="line">// ...</span>
<span class="line">app.use(&#39;/home&#39;, index)</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯¥åº”ç”¨ç¨‹åºç°åœ¨å°†èƒ½å¤Ÿå¤„ç†å¯¹<code>/home</code>å’Œçš„è¯·æ±‚<code>/home/user/123456</code></p><h4 id="_7-2-3-router-routeæ–¹æ³•" tabindex="-1"><a class="header-anchor" href="#_7-2-3-router-routeæ–¹æ³•"><span>7.2.3 router.routeæ–¹æ³•</span></a></h4><blockquote><p>routerå®ä¾‹å¯¹è±¡çš„routeæ–¹æ³•ï¼Œå¯ä»¥æ¥å—è®¿é—®è·¯å¾„ä½œä¸ºå‚æ•°</p></blockquote><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">var router = express.Router();</span>
<span class="line"></span>
<span class="line">router.route(&#39;/api&#39;)</span>
<span class="line">	.post(function(req, res) {</span>
<span class="line">		// ...</span>
<span class="line">	})</span>
<span class="line">	.get(function(req, res) {</span>
<span class="line">		Bear.find(function(err, bears) {</span>
<span class="line">			if (err) res.send(err);</span>
<span class="line">			res.json(bears);</span>
<span class="line">		});</span>
<span class="line">	});</span>
<span class="line"></span>
<span class="line">module.exports=  router</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-3-é”™è¯¯å¤„ç†ä¸­é—´ä»¶" tabindex="-1"><a class="header-anchor" href="#_7-3-é”™è¯¯å¤„ç†ä¸­é—´ä»¶"><span>7.3 é”™è¯¯å¤„ç†ä¸­é—´ä»¶</span></a></h3><p>é”™è¯¯å¤„ç†ä¸­é—´ä»¶å’Œå…¶ä»–ä¸­é—´ä»¶å®šä¹‰ç±»ä¼¼ï¼Œåªæ˜¯è¦ä½¿ç”¨ 4 ä¸ªå‚æ•°ï¼Œè€Œä¸æ˜¯ 3 ä¸ªï¼Œå…¶ç­¾åå¦‚ä¸‹ï¼š (err, req, res, next)ã€‚</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">//ä¸Šé¢çš„ä¸­é—´ä»¶éƒ½æ²¡æœ‰åŒ¹é…å°±ä¼šèµ°è¿™é‡Œ</span>
<span class="line">app.use(function(err, req, res, next) {</span>
<span class="line">  console.error(err.stack)</span>
<span class="line">     //sendçš„çŠ¶æ€ç é»˜è®¤æ˜¯200</span>
<span class="line">  res.status(500).send(&#39;error&#39;)</span>
<span class="line">})</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-4-å†…ç½®çš„ä¸­é—´ä»¶" tabindex="-1"><a class="header-anchor" href="#_7-4-å†…ç½®çš„ä¸­é—´ä»¶"><span>7.4 å†…ç½®çš„ä¸­é—´ä»¶</span></a></h3><p>express.static æ˜¯ Express å”¯ä¸€å†…ç½®çš„ä¸­é—´ä»¶ã€‚å®ƒåŸºäº serve-staticï¼Œè´Ÿè´£åœ¨ Express åº”ç”¨ä¸­ææ‰˜ç®¡é™æ€èµ„æºã€‚æ¯ä¸ªåº”ç”¨å¯æœ‰å¤šä¸ªé™æ€ç›®å½•ã€‚</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">app.use(express.static(&#39;public&#39;))</span>
<span class="line">app.use(express.static(&#39;uploads&#39;))</span>
<span class="line">app.use(express.static(&#39;files&#39;))</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="_7-5-ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶" tabindex="-1"><a class="header-anchor" href="#_7-5-ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶"><span>7.5 ç¬¬ä¸‰æ–¹ä¸­é—´ä»¶</span></a></h3><p>å®‰è£…æ‰€éœ€åŠŸèƒ½çš„ node æ¨¡å—ï¼Œå¹¶åœ¨åº”ç”¨ä¸­åŠ è½½ï¼Œå¯ä»¥åœ¨åº”ç”¨çº§åŠ è½½ï¼Œä¹Ÿå¯ä»¥åœ¨è·¯ç”±çº§åŠ è½½ã€‚</p><p>ä¸‹é¢çš„ä¾‹å­å®‰è£…å¹¶åŠ è½½äº†ä¸€ä¸ªè§£æ cookie çš„ä¸­é—´ä»¶ï¼š cookie-parser</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">$ npm install cookie-parser</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">var express = require(&#39;express&#39;)</span>
<span class="line">var app = express()</span>
<span class="line">var cookieParser = require(&#39;cookie-parser&#39;)</span>
<span class="line"></span>
<span class="line">// åŠ è½½ç”¨äºè§£æ cookie çš„ä¸­é—´ä»¶</span>
<span class="line">app.use(cookieParser())</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="_8-è·å–å‚æ•°" tabindex="-1"><a class="header-anchor" href="#_8-è·å–å‚æ•°"><span>8.è·å–å‚æ•°</span></a></h2><h3 id="_8-1-req-query" tabindex="-1"><a class="header-anchor" href="#_8-1-req-query"><span>8.1 req.query</span></a></h3><p>req.query()å¯ä»¥ç”¨æ¥è·å–æ¥å£è¯·æ±‚ä¸­æ‹¼æ¥åœ¨é“¾æ¥&quot;?&quot;åè¾¹çš„å‚æ•°ï¼Œä¸»è¦ç”¨äºgetè¯·æ±‚ï¼Œpostè¯·æ±‚ä¹Ÿé€‚ç”¨ã€‚ req.query()è¢«expressåŸç”Ÿæ”¯æŒï¼Œå¹¶ä¸”ä¼šè‡ªåŠ¨å°†å‚æ•°è½¬æ¢ä¸ºå¯¹è±¡å½¢å¼è¿”å›ã€‚ è¯·æ±‚ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">http://localhost:5050/server?p=user&amp;q=password</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>expressæ¥å£:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">let express = require(&#39;express&#39;)</span>
<span class="line">let server = express()</span>
<span class="line">server.get(&#39;/server&#39;,(req,resp)=&gt;{</span>
<span class="line">    console.log(req.query);</span>
<span class="line">    resp.send(&#39;&#39;)</span>
<span class="line">})</span>
<span class="line">server.listen(5050,()=&gt;{</span>
<span class="line">    console.log(&#39;æœåŠ¡å™¨å·²å°±ç»ª&#39;)</span>
<span class="line">})</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯·æ±‚åå¾—åˆ°çš„ç»“æœï¼š</p><p><a href="https://camo.githubusercontent.com/9f10f480b3b71ff3ea468ebf6fc0fe320ed3fe7e3724b4662aa58339f7a1e9a9/68747470733a2f2f69302e6864736c622e636f6d2f6266732f616c62756d2f373561663332623962313866313863353135373230666561393930396532656539653938313233632e706e67" target="_blank" rel="noopener noreferrer"><img src="https://camo.githubusercontent.com/9f10f480b3b71ff3ea468ebf6fc0fe320ed3fe7e3724b4662aa58339f7a1e9a9/68747470733a2f2f69302e6864736c622e636f6d2f6266732f616c62756d2f373561663332623962313866313863353135373230666561393930396532656539653938313233632e706e67" alt="image-20221103202150243"></a></p><h3 id="_8-2-req-params" tabindex="-1"><a class="header-anchor" href="#_8-2-req-params"><span>8.2 req.params</span></a></h3><p>req.params()æœ‰äº›ç‰¹æ®Šï¼Œå®ƒé€‚ç”¨äºåœ¨urlé“¾æ¥ä¸Šä¼ é€’æ•°æ®å‚æ•°ï¼Œéœ€è¦åå°æ¥å£ç”¨==:å˜é‡å==çš„å†™æ³•å‘èµ·è¯·æ±‚ã€‚</p><p>è¯·æ±‚ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">http://localhost:5050/nums/1000</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>expressæ¥å£ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">let express = require(&#39;express&#39;)</span>
<span class="line">let server = express();</span>
<span class="line">server.get(&#39;/nums/:num&#39;, (req, resp) =&gt; {</span>
<span class="line">  console.log(req.params);</span>
<span class="line">  resp.send(&#39;&#39;)</span>
<span class="line">})</span>
<span class="line">server.listen(5050, () =&gt;{</span>
<span class="line">	 console.log(&#39;æœåŠ¡å™¨å·²å°±ç»ª&#39;)</span>
<span class="line">})</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>è¯·æ±‚åå¾—åˆ°çš„ç»“æœï¼š</p><p><a href="https://camo.githubusercontent.com/d87954e6d9e79a02a168b250aeffba0a8a4a2183e72afcb945246da78b0bcec9/68747470733a2f2f69302e6864736c622e636f6d2f6266732f616c62756d2f373764363161316163306638623864313664333435343062636630326637626666323839383963362e706e67" target="_blank" rel="noopener noreferrer"><img src="https://camo.githubusercontent.com/d87954e6d9e79a02a168b250aeffba0a8a4a2183e72afcb945246da78b0bcec9/68747470733a2f2f69302e6864736c622e636f6d2f6266732f616c62756d2f373764363161316163306638623864313664333435343062636630326637626666323839383963362e706e67" alt="image-20221103202245942"></a></p><h3 id="_8-3-req-body" tabindex="-1"><a class="header-anchor" href="#_8-3-req-body"><span>8.3 req.body</span></a></h3><p>req.body()è¢«åŸç”Ÿexpressæ‰€æ”¯æŒ,å¯ä»¥ç›´æ¥ä½¿ç”¨req.body()è·å–postè¯·æ±‚çš„è¡¨å•æ•°æ®ã€‚</p><p>è¯·æ±‚:</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">fecth(&#39;http://localhost:5050/people&#39;,{</span>
<span class="line">    method: &#39;post&#39;,</span>
<span class="line">    headers: {</span>
<span class="line">        &#39;Content-Type&#39;: &#39;application/json&#39;</span>
<span class="line">    },</span>
<span class="line">    body:{name: &#39;zhangsan&#39;, age: 15}</span>
<span class="line">})</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>expressæ¥å£ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">const express = require(&#39;express&#39;);</span>
<span class="line">const server = express();</span>
<span class="line">//é…ç½®è§£æpostå‚æ•°çš„-ä¸ç”¨ä¸‹è½½ç¬¬ä¸‰æ–¹ ,å†…ç½®</span>
<span class="line">//è§£æpostå‚æ•°-(url-kyæ ¼å¼) username=kerwin&amp;password=1234</span>
<span class="line">// app.use(express.urlencoded({ extended: false }));</span>
<span class="line">//è§£æpostå‚æ•°-(jsonå­—ç¬¦ä¸²) {name:&quot;&quot;,age:100}</span>
<span class="line">app.use(express.json());</span>
<span class="line">server.post(&#39;/people&#39;, (req, resp) =&gt; {</span>
<span class="line">  console.log(req.body);</span>
<span class="line">  resp.send(&#39;&#39;)</span>
<span class="line">})</span>
<span class="line">server.listen(5050, () =&gt; console.log(&#39;æœåŠ¡å™¨å·²å°±ç»ª&#39;))</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://camo.githubusercontent.com/90d91021b2e4cb3830bb765af54450a0433aa76a5d639fb44984856878b59e9a/68747470733a2f2f69302e6864736c622e636f6d2f6266732f616c62756d2f323563626237616431346332313037376164643637316335383665306631386634613663363162382e706e67" target="_blank" rel="noopener noreferrer"><img src="https://camo.githubusercontent.com/90d91021b2e4cb3830bb765af54450a0433aa76a5d639fb44984856878b59e9a/68747470733a2f2f69302e6864736c622e636f6d2f6266732f616c62756d2f323563626237616431346332313037376164643637316335383665306631386634613663363162382e706e67" alt="image-20221103202743889"></a></p><h2 id="_9-åˆ©ç”¨-express-æ‰˜ç®¡é™æ€æ–‡ä»¶" tabindex="-1"><a class="header-anchor" href="#_9-åˆ©ç”¨-express-æ‰˜ç®¡é™æ€æ–‡ä»¶"><span>9.åˆ©ç”¨ Express æ‰˜ç®¡é™æ€æ–‡ä»¶</span></a></h2><p>é€šè¿‡ Express å†…ç½®çš„ express.static å¯ä»¥æ–¹ä¾¿åœ°æ‰˜ç®¡é™æ€æ–‡ä»¶ï¼Œä¾‹å¦‚å›¾ç‰‡ã€CSSã€JavaScript æ–‡ä»¶ç­‰ã€‚</p><p>å°†é™æ€èµ„æºæ–‡ä»¶æ‰€åœ¨çš„ç›®å½•ä½œä¸ºå‚æ•°ä¼ é€’ç»™ express.static ä¸­é—´ä»¶å°±å¯ä»¥æä¾›é™æ€èµ„æºæ–‡ä»¶çš„è®¿é—®äº†ã€‚ä¾‹å¦‚ï¼Œå‡è®¾åœ¨ public ç›®å½•æ”¾ç½®äº†å›¾ç‰‡ã€CSS å’Œ JavaScript æ–‡ä»¶ï¼Œä½ å°±å¯ä»¥ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">//ç›´æ¥å°†publicé‡Œçš„index.htmlå½“æˆ/çš„ç½‘é¡µ</span>
<span class="line">app.use(express.static(&#39;public&#39;))</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œpublic ç›®å½•ä¸‹é¢çš„æ–‡ä»¶å°±å¯ä»¥è®¿é—®äº†ã€‚</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">http://localhost:3000/images/kitten.jpg</span>
<span class="line">http://localhost:3000/css/style.css</span>
<span class="line">http://localhost:3000/js/app.js</span>
<span class="line">http://localhost:3000/images/bg.png</span>
<span class="line">http://localhost:3000/hello.html</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><blockquote><p>æ‰€æœ‰æ–‡ä»¶çš„è·¯å¾„éƒ½æ˜¯ç›¸å¯¹äºå­˜æ”¾ç›®å½•çš„ï¼Œå› æ­¤ï¼Œå­˜æ”¾é™æ€æ–‡ä»¶çš„ç›®å½•åä¸ä¼šå‡ºç°åœ¨ URL ä¸­ã€‚</p></blockquote><p>å¦‚æœä½ çš„é™æ€èµ„æºå­˜æ”¾åœ¨å¤šä¸ªç›®å½•ä¸‹é¢ï¼Œä½ å¯ä»¥å¤šæ¬¡è°ƒç”¨ express.static ä¸­é—´ä»¶ï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">app.use(express.static(&#39;public&#39;))</span>
<span class="line">app.use(express.static(&#39;files&#39;))</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div></div></div><p>è®¿é—®é™æ€èµ„æºæ–‡ä»¶æ—¶ï¼Œexpress.static ä¸­é—´ä»¶ä¼šæ ¹æ®ç›®å½•æ·»åŠ çš„é¡ºåºæŸ¥æ‰¾æ‰€éœ€çš„æ–‡ä»¶ã€‚</p><p>å¦‚æœä½ å¸Œæœ›æ‰€æœ‰é€šè¿‡ express.static è®¿é—®çš„æ–‡ä»¶éƒ½å­˜æ”¾åœ¨ä¸€ä¸ªâ€œè™šæ‹Ÿï¼ˆvirtualï¼‰â€ç›®å½•ï¼ˆå³ç›®å½•æ ¹æœ¬ä¸å­˜åœ¨ï¼‰ä¸‹é¢ï¼Œå¯ä»¥é€šè¿‡ä¸ºé™æ€èµ„æºç›®å½•æŒ‡å®šä¸€ä¸ªæŒ‚è½½è·¯å¾„çš„æ–¹å¼æ¥å®ç°ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">app.use(&#39;/static&#39;, express.static(&#39;public&#39;))</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><p>ç°åœ¨ï¼Œä½ å°±å¯ä»¥é€šè¿‡å¸¦æœ‰ â€œ/staticâ€ å‰ç¼€çš„åœ°å€æ¥è®¿é—® public ç›®å½•ä¸‹é¢çš„æ–‡ä»¶äº†ã€‚</p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">http://localhost:3000/static/images/kitten.jpg</span>
<span class="line">http://localhost:3000/static/css/style.css</span>
<span class="line">http://localhost:3000/static/js/app.js</span>
<span class="line">http://localhost:3000/static/images/bg.png</span>
<span class="line">http://localhost:3000/static/hello.html</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>æ€»ç»“</strong></p><div class="language-text line-numbers-mode" data-highlighter="prismjs" data-ext="text"><pre><code class="language-text"><span class="line">app.use(express.static(&#39;public&#39;))</span>
<span class="line">&lt;link rel=&quot;stylesheet&quot; href=&quot;/css/index.css&quot; /&gt;</span>
<span class="line">    </span>
<span class="line">app.use(&#39;/static&#39;, express.static(&#39;public&#39;))</span>
<span class="line">&lt;link rel=&quot;stylesheet&quot; href=&quot;/static/css/index.css&quot; /&gt;</span>
<span class="line"></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div>`,161)])])}const o=s(t,[["render",l]]),r=JSON.parse('{"path":"/posts/express%E7%9A%84%E4%BD%BF%E7%94%A8.html","title":"Express åŸºæœ¬ä½¿ç”¨","lang":"zh-CN","frontmatter":{"title":"Express åŸºæœ¬ä½¿ç”¨","date":"2025-11-20T00:00:00.000Z","categories":["åç«¯å¼€å‘"],"tags":["Node.js","Express"]},"git":{"updatedTime":1763876626000,"contributors":[{"name":"52nnnn","username":"52nnnn","email":"2764304248@qq.com","commits":2,"url":"https://github.com/52nnnn"},{"name":"Claude","username":"Claude","email":"noreply@anthropic.com","commits":2,"url":"https://github.com/Claude"}],"changelog":[{"hash":"aa91574c05586a9ad50920573505bd3b926a2363","time":1763876626000,"email":"2764304248@qq.com","author":"52nnnn","message":"fix: ä¸ºæ‰€æœ‰æ–‡æ¡£æ·»åŠ  frontmatter æ ¼å¼","coAuthors":[{"name":"Claude","email":"noreply@anthropic.com"}]},{"hash":"6ed236e441ae5cfe1b0c306c713a231ed7ebc9fd","time":1763805959000,"email":"2764304248@qq.com","author":"52nnnn","message":"docs: æ•´åˆæ ¹ç›®å½•æ–‡æ¡£åˆ°åšå®¢æŒ‡å—","coAuthors":[{"name":"Claude","email":"noreply@anthropic.com"}]}]},"filePathRelative":"posts/expressçš„ä½¿ç”¨.md"}');export{o as comp,r as data};
